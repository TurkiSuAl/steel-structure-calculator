<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø§Ø³Ø¨Ø© ØªÙƒÙ„ÙØ© Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ©</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap');
:root{
  --bg:#0f1117;--card:#1a1d27;--card2:#222638;--inp:#141620;
  --blue:#5b8ff9;--blue-g:rgba(91,143,249,.15);
  --green:#4caf7d;--green-g:rgba(76,175,125,.12);
  --amber:#f0a53a;--red:#ef5350;
  --text:#e2e4ea;--dim:#7e8494;--border:#2e3345;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'IBM Plex Sans Arabic',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;direction:rtl}

/* â”€â”€â”€ NAV TABS â”€â”€â”€ */
.nav{display:flex;justify-content:center;gap:6px;padding:20px 12px 0;flex-wrap:wrap}
.nav button{background:var(--card);border:1px solid var(--border);color:var(--dim);padding:9px 18px;border-radius:10px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:inherit;transition:.2s;white-space:nowrap}
.nav button:hover{border-color:var(--blue);color:var(--text)}
.nav button.active{background:var(--blue);border-color:var(--blue);color:#fff;box-shadow:0 0 12px var(--blue-g)}

/* â”€â”€â”€ PAGES â”€â”€â”€ */
.page{display:none;max-width:1100px;margin:0 auto;padding:18px 14px 40px}
.page.show{display:block}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.pg-head{text-align:center;margin-bottom:22px}
.pg-head h1{font-size:1.4rem;font-weight:700;background:linear-gradient(135deg,var(--blue),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.pg-head p{color:var(--dim);font-size:.78rem;margin-top:4px}

/* â”€â”€â”€ CARD â”€â”€â”€ */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:16px}
.ch{display:flex;align-items:center;gap:8px;padding:11px 16px;background:var(--card2);border-bottom:1px solid var(--border)}
.ch .icon{font-size:1.1rem}.ch h2{font-size:.85rem;font-weight:600}
.cb{padding:16px}

/* â”€â”€â”€ INPUT GRID (dims) â”€â”€â”€ */
.ig{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.ig-item label{display:block;font-size:.75rem;color:var(--dim);margin-bottom:5px;font-weight:500}
.ig-item .iw{position:relative}
.ig-item input{width:100%;background:var(--inp);border:1px solid var(--border);border-radius:7px;padding:8px 32px 8px 10px;color:var(--blue);font-size:.92rem;font-weight:700;font-family:inherit;text-align:right;transition:.2s}
.ig-item input:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px var(--blue-g)}
.ig-item .u{position:absolute;left:9px;top:50%;transform:translateY(-50%);font-size:.7rem;color:var(--dim);pointer-events:none}

/* â”€â”€â”€ AUTO CALC ROW â”€â”€â”€ */
.acr{display:grid;grid-template-columns:repeat(3,1fr);gap:9px}
.ac-item{background:var(--green-g);border:1px solid rgba(76,175,125,.2);border-radius:9px;padding:10px 12px}
.ac-item .al{font-size:.7rem;color:var(--green);font-weight:600;margin-bottom:3px}
.ac-item .av{font-size:.95rem;font-weight:700}
.ac-item .au{font-size:.66rem;color:var(--dim)}

/* â”€â”€â”€ TABLE â”€â”€â”€ */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.95rem}
th{background:var(--card2);color:var(--dim);font-weight:600;padding:11px 10px;text-align:right;border-bottom:1px solid var(--border);white-space:nowrap;font-size:.88rem}
td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:right;font-size:.9rem}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.02)}
td input,td select{background:var(--inp);border:1px solid transparent;border-radius:5px;padding:6px 8px;color:var(--blue);font-size:.9rem;font-family:inherit;width:100%;text-align:right;font-weight:600;transition:.2s}
td input:focus,td select:focus{outline:none;border-color:var(--blue)}
td select{cursor:pointer;appearance:none;-webkit-appearance:none}
td select option{background:var(--card);color:var(--text)}
.ro{color:var(--green) !important;font-weight:700;background:transparent !important;border-color:transparent !important;pointer-events:none}
.rn{color:var(--dim);font-weight:600;font-size:.82rem}
.nc{color:var(--dim);font-size:.8rem;font-style:italic}
td input.wide{width:100%}

/* ADD / DEL â”€â”€â”€ */
.btn-add{display:inline-flex;align-items:center;gap:5px;margin-top:10px;background:rgba(91,143,249,.08);border:1px dashed var(--blue);color:var(--blue);font-size:.76rem;padding:5px 13px;border-radius:7px;cursor:pointer;font-family:inherit;transition:.2s}
.btn-add:hover{background:rgba(91,143,249,.17)}
.btn-del{background:none;border:none;color:var(--dim);cursor:pointer;font-size:1rem;padding:1px 5px;border-radius:4px;transition:.2s}
.btn-del:hover{color:var(--red);background:rgba(239,83,80,.1)}

/* â”€â”€â”€ SUMMARY CARDS â”€â”€â”€ */
.sc-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.sc{border-radius:11px;padding:16px 14px;text-align:center}
.sc.m{background:linear-gradient(135deg,rgba(91,143,249,.12),rgba(91,143,249,.04));border:1px solid rgba(91,143,249,.2)}
.sc.i{background:linear-gradient(135deg,rgba(240,165,58,.12),rgba(240,165,58,.04));border:1px solid rgba(240,165,58,.2)}
.sc.l{background:linear-gradient(135deg,rgba(76,175,125,.12),rgba(76,175,125,.04));border:1px solid rgba(76,175,125,.2)}
.sc .sl{font-size:.73rem;color:var(--dim);margin-bottom:5px;font-weight:600}
.sc .sv{font-size:1.25rem;font-weight:700}
.sc.m .sv{color:var(--blue)}.sc.i .sv{color:var(--amber)}.sc.l .sv{color:var(--green)}

.total-box{margin-top:14px;background:linear-gradient(135deg,rgba(239,83,80,.08),rgba(240,165,58,.06));border:1px solid rgba(239,83,80,.2);border-radius:11px;padding:16px 18px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.total-box .tbl{font-size:.84rem;color:var(--dim);font-weight:600}
.total-box .tbv{font-size:1.5rem;font-weight:700;color:var(--red)}
.total-box .tbs{font-size:.72rem;color:var(--dim);margin-top:2px}

.profit-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding:11px 14px;background:var(--card2);border-radius:9px;flex-wrap:wrap;gap:10px}
.profit-row .pri{display:flex;flex-direction:column}
.profit-row .prl{font-size:.7rem;color:var(--dim)}
.profit-row .prv{font-size:.95rem;font-weight:700;color:var(--green)}
.profit-row input{background:var(--inp);border:1px solid var(--border);border-radius:5px;padding:5px 26px 5px 8px;color:var(--blue);font-size:.88rem;font-weight:700;font-family:inherit;width:100px;text-align:right;margin-top:3px}
.profit-row input:focus{outline:none;border-color:var(--blue)}

/* LEGEND */
.legend{display:flex;gap:14px;margin-top:12px;flex-wrap:wrap}
.legend-i{display:flex;align-items:center;gap:5px;font-size:.74rem;color:var(--dim)}
.ld{width:9px;height:9px;border-radius:3px}.ld.b{background:var(--blue)}.ld.g{background:var(--green)}

/* â”€â”€â”€ INSTRUCTIONS PAGE â”€â”€â”€ */
.inst-list{list-style:none;counter-reset:inst}
.inst-list li{counter-increment:inst;display:flex;gap:12px;align-items:flex-start;padding:14px 0;border-bottom:1px solid var(--border)}
.inst-list li:last-child{border-bottom:none}
.inst-list .num{background:var(--blue);color:#fff;width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;flex-shrink:0}
.inst-list .txt{font-size:.84rem;line-height:1.5;color:var(--text)}
.inst-list .txt strong{color:var(--blue)}
.note-box{background:rgba(240,165,58,.07);border:1px solid rgba(240,165,58,.25);border-radius:10px;padding:14px 16px;margin-top:16px}
.note-box h3{color:var(--amber);font-size:.82rem;margin-bottom:8px}
.note-box ul{list-style:none;padding:0}
.note-box ul li{font-size:.79rem;color:var(--text);padding:4px 0;display:flex;gap:8px;align-items:flex-start}
.note-box ul li .ic{flex-shrink:0}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
@media(max-width:640px){.ig,.acr,.sc-row{grid-template-columns:1fr 1fr}}
@media(max-width:380px){.ig,.acr,.sc-row{grid-template-columns:1fr}}

/* helpers */
.fmt{font-variant-numeric:tabular-nums}
.row-total-highlight td{background:rgba(240,165,58,.06);font-weight:700;color:var(--amber);border-top:2px solid rgba(240,165,58,.25) !important}

/* price-db highlight (editable price) */
.price-cell input{color:var(--amber) !important}

/* select with green border when auto-linked */
.linked-select{border-color:rgba(76,175,125,.4) !important}

/* â”€â”€â”€ DB TOOLBAR â”€â”€â”€ */
.db-toolbar{display:flex;justify-content:center;gap:8px;padding:8px 12px;flex-wrap:wrap}
.db-toolbar button{background:var(--card2);border:1px solid var(--border);color:var(--dim);padding:6px 14px;border-radius:8px;font-size:.75rem;font-weight:600;cursor:pointer;font-family:inherit;transition:.2s}
.db-toolbar button:hover{border-color:var(--green);color:var(--green)}
.db-toolbar .db-status{font-size:.7rem;color:var(--green);align-self:center;display:none}

/* â”€â”€â”€ EMPLOYEE CARDS â”€â”€â”€ */
.emp-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.emp-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.emp-name{font-size:1.05rem;font-weight:700}
.emp-role{font-size:.8rem;color:var(--dim);margin-top:2px}
.emp-salary{font-size:1.2rem;font-weight:700;color:var(--green)}
.emp-section{margin-top:14px;padding-top:14px;border-top:1px solid var(--border)}
.emp-section-title{font-size:.75rem;color:var(--dim);font-weight:600;margin-bottom:8px}
.emp-item{font-size:.85rem;margin:4px 0;display:flex;justify-content:space-between;padding:4px 0}
.emp-item .tool-name{flex:1}
.emp-item .tool-value{color:var(--amber);font-weight:600}
.emp-item .tool-date{font-size:.75rem;color:var(--dim);margin-right:8px}

/* â”€â”€â”€ PROJECT CARDS â”€â”€â”€ */
.project-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;transition:.2s}
.project-card:hover{border-color:var(--blue);transform:translateY(-2px)}
.project-title{font-size:1rem;font-weight:700;margin-bottom:8px}
.project-meta{font-size:.75rem;color:var(--dim);margin:4px 0}
.project-cost{font-size:1.1rem;font-weight:700;color:var(--amber);margin-top:10px}
.project-profit{font-size:1rem;font-weight:700;color:var(--green);margin-top:6px}
.project-actions{display:flex;gap:8px;margin-top:14px}
.project-actions button{flex:1;padding:7px;border-radius:7px;font-size:.8rem;cursor:pointer;font-family:inherit;transition:.2s}
</style>
</head>
<body>

<!-- PASSWORD OVERLAY -->
<div id="passwordOverlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,17,23,0.98);display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:40px;max-width:400px;width:90%;text-align:center;">
    <div style="font-size:4rem;margin-bottom:20px;">ğŸƒ</div>
    <h2 style="font-size:1.3rem;margin-bottom:10px;color:var(--text);">Ø¥Ø°Ø§ Ù…Ø§ Ù…Ø¹Ùƒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±... Ø§Ø°Ù„Ù ğŸ˜ˆ</h2>
    <p style="color:var(--dim);font-size:.85rem;margin-bottom:25px;">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù… ÙÙ‚Ø·</p>
    <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%;background:var(--inp);border:1px solid var(--border);border-radius:8px;padding:12px 16px;color:var(--text);font-size:.95rem;font-family:inherit;text-align:center;margin-bottom:15px;" onkeypress="if(event.key==='Enter')checkPassword()">
    <button onclick="checkPassword()" style="width:100%;background:var(--blue);border:none;color:#fff;padding:12px;border-radius:8px;font-size:.9rem;font-weight:600;cursor:pointer;font-family:inherit;transition:.2s;">Ø¯Ø®ÙˆÙ„</button>
    <div id="errorMsg" style="color:var(--red);font-size:.8rem;margin-top:12px;display:none;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©... Ø§Ø°Ù„Ù! ğŸƒ</div>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button class="active" onclick="goTo('calc')">ğŸ“Š Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
  <button onclick="goTo('projects')">ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù†ÙØ°Ø©</button>
  <button onclick="goTo('employees')">ğŸ‘· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</button>
  <button onclick="goTo('mdb')">ğŸ§± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</button>
  <button onclick="goTo('idb')">ğŸ”© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯</button>
  <button onclick="goTo('inst')">ğŸ“– Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
</div>
<div class="db-toolbar">
  <button onclick="downloadDB()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button onclick="document.getElementById('dbFileInput').click()">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <input type="file" id="dbFileInput" accept=".db,.sqlite,.sqlite3" style="display:none" onchange="importDB(event)">
  <span class="db-status" id="dbStatus"></span>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ø§Ù„Ø­Ø§Ø³Ø¨Ø© â•â•â•â•â•â•â•â• -->
<div class="page show" id="pg_calc">
  <div class="pg-head"><h1>ğŸ—ï¸ Ø­Ø§Ø³Ø¨Ø© ØªÙƒÙ„ÙØ© Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ© ÙˆØ£Ù„ÙˆØ§Ø­ Ø§Ù„Ø£Ø³Ù…Ù†Øª</h1><p>Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ â€” Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</p></div>

  <!-- Save Project Button -->
  <div style="text-align:center;margin-bottom:16px">
    <button onclick="saveProject()" style="background:var(--green);border:none;color:#fff;padding:10px 24px;border-radius:8px;font-size:.9rem;font-weight:600;cursor:pointer;font-family:inherit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
  </div>

  <!-- Ø£Ø¨Ø¹Ø§Ø¯ -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
    <div class="card">
      <div class="ch"><span class="icon">ğŸ“</span><h2>Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2></div>
      <div class="cb">
        <div class="ig">
          <div class="ig-item"><label>Ø§Ù„Ø·ÙˆÙ„</label><div class="iw"><input type="number" id="i_L" value="10" oninput="calc()"><span class="u">Ù…</span></div></div>
          <div class="ig-item"><label>Ø§Ù„Ø¹Ø±Ø¶</label><div class="iw"><input type="number" id="i_W" value="22" oninput="calc()"><span class="u">Ù…</span></div></div>
          <div class="ig-item"><label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</label><div class="iw"><input type="number" id="i_H" value="3" oninput="calc()"><span class="u">Ù…</span></div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="ch"><span class="icon">ğŸªŸ</span><h2>Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø²Ø¬Ø§Ø¬ / Ø§Ù„ÙØªØ­Ø§Øª</h2></div>
      <div class="cb">
        <div class="ig">
          <div class="ig-item"><label>Ø·ÙˆÙ„ Ø§Ù„Ø²Ø¬Ø§Ø¬</label><div class="iw"><input type="number" id="i_gL" value="3" oninput="calc()"><span class="u">Ù…</span></div></div>
          <div class="ig-item"><label>Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø¬Ø§Ø¬</label><div class="iw"><input type="number" id="i_gW" value="1" oninput="calc()"><span class="u">Ù…</span></div></div>
          <div class="ig-item"><label>Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª</label><div class="iw"><input type="number" id="i_gN" value="31" oninput="calc()"><span class="u">Ø¹Ø¯Ø¯</span></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© -->
  <div class="card">
    <div class="ch"><span class="icon">ğŸ“Š</span><h2>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h2></div>
    <div class="cb">
      <div class="acr">
        <div class="ac-item"><div class="al">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ø±Ø¶ÙŠØ©</div><div class="av fmt" id="o_floor">â€”</div><div class="au">Ù…Â²</div></div>
        <div class="ac-item"><div class="al">Ù…Ø­ÙŠØ· Ø§Ù„Ù…Ø¨Ù†Ù‰</div><div class="av fmt" id="o_peri">â€”</div><div class="au">Ù…</div></div>
        <div class="ac-item"><div class="al">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„ÙƒÙ„ÙŠØ©</div><div class="av fmt" id="o_wG">â€”</div><div class="au">Ù…Â²</div></div>
        <div class="ac-item"><div class="al">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬</div><div class="av fmt" id="o_glass">â€”</div><div class="au">Ù…Â²</div></div>
        <div class="ac-item"><div class="al">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„ØµØ§ÙÙŠØ©</div><div class="av fmt" id="o_wN">â€”</div><div class="au">Ù…Â²</div></div>
        <div class="ac-item"><div class="al">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ù‚Ù</div><div class="av fmt" id="o_roof">â€”</div><div class="au">Ù…Â²</div></div>
      </div>
      <div class="legend"><div class="legend-i"><div class="ld b"></div>Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</div><div class="legend-i"><div class="ld g"></div>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</div></div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…ÙˆØ§Ø¯ -->
  <div class="card">
    <div class="ch"><span class="icon">ğŸ§±</span><h2>Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª</h2></div>
    <div class="cb">
      <div class="tw"><table><thead><tr>
        <th style="width:26px"></th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø³Ù…Ùƒ</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±.Ø³)</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th style="width:26px"></th>
      </tr></thead><tbody id="tb_mat"></tbody></table></div>
      <button class="btn-add" onclick="addMat()">ï¼‹ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
    </div>
  </div>

  <!-- Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ -->
  <div class="card">
    <div class="ch"><span class="icon">ğŸ”©</span><h2>Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ</h2></div>
    <div class="cb">
      <div class="tw"><table><thead><tr>
        <th>#</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ù‚Ø§Ø³</th><th>Ø§Ù„Ø³Ù…Ùƒ (mm)</th><th>Ø§Ù„Ø·ÙˆÙ„ (m)</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±.Ø³)</th><th style="width:26px"></th>
      </tr></thead><tbody id="tb_iron"></tbody></table></div>
      <button class="btn-add" onclick="addIron()">ï¼‹ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>
      <div style="margin-top:12px;text-align:left"><span style="color:var(--amber);font-weight:700;font-size:.84rem" class="fmt">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ¯: <span id="o_ironT">0</span> Ø±.Ø³</span></div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ù„Ø®Øµ -->
  <div class="card">
    <div class="ch"><span class="icon">ğŸ’°</span><h2>Ù…Ù„Ø®Øµ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</h2></div>
    <div class="cb">
      <div class="sc-row">
        <div class="sc m"><div class="sl">Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª</div><div class="sv fmt" id="s_mat">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
        <div class="sc i"><div class="sl">Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ</div><div class="sv fmt" id="s_iron">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
      </div>
      <div class="total-box">
        <div><div class="tbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</div><div class="tbv fmt" id="s_total">0</div></div>
        <div style="text-align:left"><div class="tbl">Ø§Ù„ØªÙƒÙ„ÙØ© Ù„ÙƒÙ„ Ù…Â² Ø£Ø±Ø¶ÙŠØ©</div><div class="tbv fmt" id="s_m2" style="font-size:1.15rem;color:var(--amber)">0</div><div class="tbs">Ø±.Ø³ / Ù…Â²</div></div>
      </div>
      <div class="profit-row">
        <div class="pri"><span class="prl">Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ %</span><div class="iw" style="position:relative"><input type="number" id="i_profit" value="0" oninput="calc()"><span style="position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:.7rem;color:var(--dim);pointer-events:none">%</span></div></div>
        <div class="pri" style="text-align:left"><span class="prl">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span><span class="prv fmt" id="s_profAmt">0 Ø±.Ø³</span></div>
        <div class="pri" style="text-align:left"><span class="prl">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù…Ø¹ Ø§Ù„Ø±Ø¨Ø­)</span><span class="prv fmt" id="s_sale" style="color:var(--red);font-size:1.1rem">0 Ø±.Ø³</span></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_mdb">
  <div class="pg-head"><h1>ğŸ§± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</h1><p>ØºÙŠÙ‘Ø± Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‡Ù†Ø§ ÙˆØªØªØ­Ø¯Ø« Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</p></div>
  <div class="card">
    <div class="ch"><span class="icon">ğŸ“‹</span><h2>Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</h2></div>
    <div class="cb">
      <div class="tw"><table><thead><tr>
        <th style="width:26px"></th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø³Ù…Ùƒ</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th style="color:var(--amber)">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø±.Ø³)</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th style="width:26px"></th>
      </tr></thead><tbody id="tb_mdb"></tbody></table></div>
      <button class="btn-add" onclick="addMdbRow()">ï¼‹ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯ â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_idb">
  <div class="pg-head"><h1>ğŸ”© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯</h1><p>Ø£Ø¯Ø®Ù„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø¯ÙŠØ¯ ÙˆØ£Ø³Ø¹Ø§Ø±Ù‡Ø§ â€” ØªØªØ­Ø¯Ø« ÙÙŠ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</p></div>
  <div class="card">
    <div class="ch"><span class="icon">ğŸ“‹</span><h2>Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</h2></div>
    <div class="cb">
      <div class="tw"><table><thead><tr>
        <th style="width:26px"></th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ù‚Ø§Ø³</th><th>Ø§Ù„Ø³Ù…Ùƒ (mm)</th><th>Ø§Ù„Ø·ÙˆÙ„ (m)</th><th style="color:var(--amber)">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø±.Ø³)</th><th style="width:26px"></th>
      </tr></thead><tbody id="tb_idb"></tbody></table></div>
      <button class="btn-add" onclick="addIdbRow()">ï¼‹ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ Ø­Ø¯ÙŠØ¯ Ø¬Ø¯ÙŠØ¯</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_inst">
  <div class="pg-head"><h1>ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h1><p>ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</p></div>
  <div class="card">
    <div class="ch"><span class="icon">ğŸ“Œ</span><h2>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2></div>
    <div class="cb">
      <ol class="inst-list">
        <li><div class="num">1</div><div class="txt">Ø£Ø¯Ø®Ù„ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ <strong>(Ø§Ù„Ø·ÙˆÙ„ / Ø§Ù„Ø¹Ø±Ø¶ / Ø§Ù„Ø§Ø±ØªÙØ§Ø¹)</strong> ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</div></li>
        <li><div class="num">2</div><div class="txt">Ø£Ø¯Ø®Ù„ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø²Ø¬Ø§Ø¬ ÙˆØ§Ù„ÙØªØ­Ø§Øª <strong>(Ø·ÙˆÙ„ / Ø¹Ø±Ø¶ / Ø¹Ø¯Ø¯)</strong> ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª ØªØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div></li>
        <li><div class="num">3</div><div class="txt">Ø§Ø®ØªØ± Ù†ÙˆØ¹ ÙˆØ³Ù…Ùƒ ÙƒÙ„ Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… â€” Ø§Ù„Ø³Ø¹Ø± ÙŠØ¬ÙŠÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† <strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</strong></div></li>
        <li><div class="num">4</div><div class="txt">Ø§Ø°Ù‡Ø¨ Ù„ØµÙØ­Ø© <strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯</strong> ÙˆØ£Ø¯Ø®Ù„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø¯ÙŠØ¯ ÙˆØ£Ø³Ø¹Ø§Ø±Ù‡Ø§</div></li>
        <li><div class="num">5</div><div class="txt">Ø­Ø¯Ø¯ <strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­</strong> Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ</div></li>
        <li><div class="num">6</div><div class="txt">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙŠ <strong>Ù…Ù„Ø®Øµ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</strong> !</div></li>
      </ol>
    </div>
  </div>
  <div class="note-box">
    <h3>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©</h3>
    <ul>
      <li><span class="ic">ğŸ”µ</span> Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ = Ù…Ø¯Ø®Ù„Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</li>
      <li><span class="ic">ğŸŸ¢</span> Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ = Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
      <li><span class="ic">ğŸŸ </span> Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ <strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</strong> Ùˆ<strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ø¯ÙŠØ¯</strong> Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ± Ù…Ù…ÙƒÙ† ØªØ¹Ø¯Ù‘Ù„Ù‡Ø§ Ù…ØªÙ‰ Ø´Ø§Ø¡</li>
      <li><span class="ic">â•</span> ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø¯ Ø£Ùˆ Ø¹Ù†Ø§ØµØ± Ø­Ø¯ÙŠØ¯ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ÙƒÙ„ Ø¬Ø¯ÙˆÙ„</li>
      <li><span class="ic">ğŸ“Š</span> Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© ØªØ´Ù…Ù„: Ø§Ù„Ù…ÙˆØ§Ø¯ + Ø§Ù„Ø­Ø¯ÙŠØ¯ + Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</li>
    </ul>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_employees">
  <div class="pg-head"><h1>ğŸ‘· Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø¹Ù‡Ø¯</h1><p>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</p></div>

  <div class="card">
    <div class="ch"><span class="icon">ğŸ‘¥</span><h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</h2></div>
    <div class="cb">
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px" id="employeesList"></div>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div style="display:flex;align-items:center;gap:8px"><span class="icon">ğŸš—</span><h2>Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h2></div>
      <button style="background:var(--blue);border:none;color:#fff;padding:6px 14px;border-radius:7px;font-size:.8rem;font-weight:600;cursor:pointer" onclick="addCarRecord()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„</button>
    </div>
    <div class="cb">
      <div class="tw"><table>
        <thead><tr>
          <th style="width:100px">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th style="width:80px">Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
          <th style="width:100px">Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³)</th>
          <th style="width:90px">Ø§Ù„Ø¹Ø¯Ø§Ø¯ (ÙƒÙ…)</th>
          <th style="width:40px"></th>
        </tr></thead>
        <tbody id="carRecordsBody"></tbody>
      </table></div>
      <div class="acr" style="margin-top:14px">
        <div class="ac-item"><div class="al">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</div><div class="av fmt" id="totalFuel">0</div><div class="au">Ø±.Ø³</div></div>
        <div class="ac-item"><div class="al">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©</div><div class="av fmt" id="totalMaint">0</div><div class="au">Ø±.Ø³</div></div>
        <div class="ac-item"><div class="al">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div><div class="av fmt" id="totalCar">0</div><div class="au">Ø±.Ø³</div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="ch"><span class="icon">ğŸ“Š</span><h2>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2></div>
    <div class="cb">
      <div class="sc-row">
        <div class="sc l"><div class="sl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨</div><div class="sv fmt" id="totalSalaries">5800</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³ / Ø´Ù‡Ø±</div></div>
        <div class="sc i"><div class="sl">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</div><div class="sv fmt" id="carExpenses">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³ / Ø´Ù‡Ø±</div></div>
        <div class="sc m"><div class="sl">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‡Ø¯</div><div class="sv fmt" id="totalTools">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
      </div>
      <div style="margin-top:16px;padding:16px;background:var(--card2);border-radius:10px">
        <div style="font-size:.85rem;color:var(--dim);margin-bottom:10px;font-weight:600">ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©</div>
        <div class="sc-row">
          <div class="sc" style="background:linear-gradient(135deg,rgba(239,83,80,.12),rgba(239,83,80,.04));border:1px solid rgba(239,83,80,.2)">
            <div class="sl">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
            <div class="sv fmt" id="monthlyCosts" style="color:var(--red)">5800</div>
            <div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
          </div>
          <div class="sc" style="background:linear-gradient(135deg,rgba(76,175,125,.12),rgba(76,175,125,.04));border:1px solid rgba(76,175,125,.2)">
            <div class="sl">Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            <div class="sv fmt" id="monthlyProfits" style="color:var(--green)">0</div>
            <div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
          </div>
          <div class="sc" id="netResult" style="background:linear-gradient(135deg,rgba(91,143,249,.12),rgba(91,143,249,.04));border:1px solid rgba(91,143,249,.2)">
            <div class="sl">Ø§Ù„ØµØ§ÙÙŠ</div>
            <div class="sv fmt" id="netProfit" style="color:var(--blue)">-5800</div>
            <div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
          </div>
        </div>
        <div id="profitMessage" style="margin-top:12px;padding:10px;border-radius:8px;font-size:.85rem;text-align:center"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù†ÙØ°Ø© â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_projects">
  <div class="pg-head"><h1>ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù†ÙØ°Ø©</h1><p>Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±</p></div>

  <div style="text-align:center;margin-bottom:20px">
    <label style="font-size:.85rem;color:var(--dim);margin-left:10px">Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±:</label>
    <select id="monthSelector" onchange="renderProjects()" style="background:var(--inp);border:1px solid var(--border);border-radius:7px;padding:8px 16px;color:var(--text);font-size:.9rem;font-family:inherit;cursor:pointer">
      <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ù‡ÙˆØ±</option>
      <option value="2026-01">ÙŠÙ†Ø§ÙŠØ± 2026</option>
      <option value="2026-02">ÙØ¨Ø±Ø§ÙŠØ± 2026</option>
      <option value="2026-03">Ù…Ø§Ø±Ø³ 2026</option>
      <option value="2026-04">Ø£Ø¨Ø±ÙŠÙ„ 2026</option>
      <option value="2026-05">Ù…Ø§ÙŠÙˆ 2026</option>
      <option value="2026-06">ÙŠÙˆÙ†ÙŠÙˆ 2026</option>
      <option value="2026-07">ÙŠÙˆÙ„ÙŠÙˆ 2026</option>
      <option value="2026-08">Ø£ØºØ³Ø·Ø³ 2026</option>
      <option value="2026-09">Ø³Ø¨ØªÙ…Ø¨Ø± 2026</option>
      <option value="2026-10">Ø£ÙƒØªÙˆØ¨Ø± 2026</option>
      <option value="2026-11">Ù†ÙˆÙÙ…Ø¨Ø± 2026</option>
      <option value="2026-12">Ø¯ÙŠØ³Ù…Ø¨Ø± 2026</option>
    </select>
  </div>

  <div class="sc-row" style="margin-bottom:20px">
    <div class="sc m"><div class="sl">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="sv fmt" id="projectCount">0</div><div style="color:var(--dim);font-size:.7rem">Ù…Ø´Ø±ÙˆØ¹</div></div>
    <div class="sc i"><div class="sl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</div><div class="sv fmt" id="totalCostsProjects">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
    <div class="sc l"><div class="sl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div><div class="sv fmt" id="totalProfitsProjects">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
  </div>

  <div id="projectsList" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px"></div>
  <div id="noProjects" style="text-align:center;padding:60px 20px;color:var(--dim);display:none">
    <div style="font-size:3rem;margin-bottom:16px">ğŸ“</div>
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• PAGE: ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ â•â•â•â•â•â•â•â• -->
<div class="page" id="pg_projectDetails">
  <div style="margin-bottom:20px">
    <button onclick="goTo('projects')" style="background:var(--card2);border:1px solid var(--border);color:var(--text);padding:8px 16px;border-radius:8px;font-size:.85rem;cursor:pointer">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</button>
  </div>

  <div class="pg-head">
    <h1 id="projectDetailTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h1>
    <p id="projectDetailMeta"></p>
  </div>

  <div style="text-align:center;margin-bottom:20px">
    <button id="statusToggleBtn" onclick="toggleProjectStatus()" style="padding:10px 24px;border-radius:8px;font-size:.9rem;font-weight:600;cursor:pointer;border:none;color:#fff"></button>
    <button onclick="printProject()" style="background:var(--blue);border:none;color:#fff;padding:10px 24px;border-radius:8px;font-size:.9rem;font-weight:600;cursor:pointer;margin-right:10px">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
  </div>

  <div class="card">
    <div class="ch"><span class="icon">ğŸ—ºï¸</span><h2>Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2></div>
    <div class="cb">
      <div id="blueprintPreview" style="text-align:center;padding:20px">
        <p style="color:var(--dim);font-size:.85rem">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ø®Ø·Ø· Ø¨Ø¹Ø¯</p>
      </div>
      <input type="file" id="blueprintInput" accept="image/*" style="display:none" onchange="uploadBlueprint(event)">
      <button onclick="document.getElementById('blueprintInput').click()" style="background:var(--blue);border:none;color:#fff;padding:8px 16px;border-radius:7px;font-size:.85rem;cursor:pointer;margin-top:10px">ğŸ“¤ Ø±ÙØ¹ Ù…Ø®Ø·Ø·</button>
    </div>
  </div>

  <div class="card">
    <div class="ch"><span class="icon">ğŸ“Š</span><h2>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…Ù† Ø§Ù„Ø­Ø§Ø³Ø¨Ø©)</h2></div>
    <div class="cb">
      <div class="sc-row">
        <div class="sc m"><div class="sl">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div><div class="sv fmt" id="detailBaseCost">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
        <div class="sc i"><div class="sl">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</div><div class="sv fmt" id="detailSalePrice">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
        <div class="sc l"><div class="sl">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div><div class="sv fmt" id="detailBaseProfit">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div style="display:flex;align-items:center;gap:8px"><span class="icon">ğŸ§±</span><h2>Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª</h2></div>
      <button onclick="addProjectMaterial()" style="background:var(--blue);border:none;color:#fff;padding:6px 14px;border-radius:7px;font-size:.8rem;font-weight:600;cursor:pointer">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
    </div>
    <div class="cb">
      <div class="tw"><table>
        <thead><tr><th style="width:30px">#</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø³ÙÙ…Ùƒ</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th></th></tr></thead>
        <tbody id="projectMaterialsTable"></tbody>
      </table></div>
      <div style="text-align:left;margin-top:12px;font-size:1.1rem;font-weight:700;color:var(--blue)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯: <span id="projectMaterialsTotal">0</span> Ø±.Ø³</div>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div style="display:flex;align-items:center;gap:8px"><span class="icon">ğŸ”©</span><h2>Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ</h2></div>
      <button onclick="addProjectIron()" style="background:var(--blue);border:none;color:#fff;padding:6px 14px;border-radius:7px;font-size:.8rem;font-weight:600;cursor:pointer">+ Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙŠØ¯</button>
    </div>
    <div class="cb">
      <div class="tw"><table>
        <thead><tr><th style="width:30px">#</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù‚ÙŠØ§Ø³</th><th>Ø§Ù„Ø³ÙÙ…Ùƒ</th><th>Ø§Ù„Ø·ÙˆÙ„</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th></th></tr></thead>
        <tbody id="projectIronsTable"></tbody>
      </table></div>
      <div style="text-align:left;margin-top:12px;font-size:1.1rem;font-weight:700;color:var(--amber)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ¯: <span id="projectIronsTotal">0</span> Ø±.Ø³</div>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div style="display:flex;align-items:center;gap:8px"><span class="icon">ğŸ’°</span><h2>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h2></div>
      <button onclick="showAddCostMenu()" style="background:var(--green);border:none;color:#fff;padding:6px 14px;border-radius:7px;font-size:.8rem;font-weight:600;cursor:pointer">+ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
    </div>
    <div class="cb">
      <div style="margin-bottom:20px">
        <h3 style="font-size:.9rem;color:var(--dim);margin-bottom:10px">ğŸš— ØªÙˆØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
        <div class="tw"><table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th></th></tr></thead><tbody id="transportTable"></tbody></table></div>
        <div style="text-align:left;margin-top:8px;font-weight:700;color:var(--amber)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="transportTotal">0</span> Ø±.Ø³</div>
      </div>
      <div style="margin-bottom:20px">
        <h3 style="font-size:.9rem;color:var(--dim);margin-bottom:10px">ğŸ‘· Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
        <div class="tw"><table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø£ÙŠØ§Ù…</th><th>Ø§Ù„Ø£Ø¬Ø±Ø©/ÙŠÙˆÙ…</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th></th></tr></thead><tbody id="dailyWorkersTable"></tbody></table></div>
        <div style="text-align:left;margin-top:8px;font-weight:700;color:var(--amber)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="dailyWorkersTotal">0</span> Ø±.Ø³</div>
      </div>
      <div style="margin-bottom:20px">
        <h3 style="font-size:.9rem;color:var(--dim);margin-bottom:10px">ğŸ§± Ù…ÙˆØ§Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <div class="tw"><table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th></th></tr></thead><tbody id="materialsTable"></tbody></table></div>
        <div style="text-align:left;margin-top:8px;font-weight:700;color:var(--amber)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="materialsTotal">0</span> Ø±.Ø³</div>
      </div>
      <div>
        <h3 style="font-size:.9rem;color:var(--dim);margin-bottom:10px">ğŸ“ Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰</h3>
        <div class="tw"><table><thead><tr><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th></th></tr></thead><tbody id="otherTable"></tbody></table></div>
        <div style="text-align:left;margin-top:8px;font-weight:700;color:var(--amber)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="otherTotal">0</span> Ø±.Ø³</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="ch"><span class="icon">ğŸ’µ</span><h2>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2></div>
    <div class="cb">
      <div class="sc-row">
        <div class="sc" style="background:linear-gradient(135deg,rgba(91,143,249,.12),rgba(91,143,249,.04));border:1px solid rgba(91,143,249,.2)">
          <div class="sl">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div><div class="sv fmt" id="finalBaseCost" style="color:var(--blue)">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
        </div>
        <div class="sc" style="background:linear-gradient(135deg,rgba(239,83,80,.12),rgba(239,83,80,.04));border:1px solid rgba(239,83,80,.2)">
          <div class="sl">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</div><div class="sv fmt" id="finalAdditional" style="color:var(--red)">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
        </div>
        <div class="sc" style="background:linear-gradient(135deg,rgba(240,165,58,.12),rgba(240,165,58,.04));border:1px solid rgba(240,165,58,.2)">
          <div class="sl">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</div><div class="sv fmt" id="finalTotal" style="color:var(--amber)">0</div><div style="color:var(--dim);font-size:.7rem">Ø±.Ø³</div>
        </div>
      </div>
      <div class="total-box" style="margin-top:16px">
        <div><div class="tbl">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</div><div class="tbv fmt" id="finalSale">0</div></div>
        <div style="text-align:left"><div class="tbl">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙØ¹Ù„ÙŠ</div><div class="tbv fmt" id="finalProfit" style="font-size:1.4rem">0</div><div class="tbs">Ø±.Ø³</div></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPT â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€â”€ SQLite DATABASE ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let DB = null; // sql.js Database instance

// â”€â”€â”€ DEFAULT DATA (used when creating fresh DB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_MDB = [
  {cat:'Cement Board', type:'Standard',   thick:'6mm',  unit:'Ù„ÙˆØ­', price:41,  note:'Ø³Ø¹Ø± Ø§Ù„Ù„ÙˆØ­'},
  {cat:'Cement Board', type:'Standard',   thick:'9mm',  unit:'Ù„ÙˆØ­', price:45,  note:''},
  {cat:'Cement Board', type:'Standard',   thick:'10mm', unit:'Ù„ÙˆØ­', price:85,  note:''},
  {cat:'Cement Board', type:'Exterior',   thick:'12mm', unit:'Ù„ÙˆØ­', price:70,  note:''},
  {cat:'Cement Board', type:'Exterior',   thick:'9mm',  unit:'Ù„ÙˆØ­', price:45,  note:''},
  {cat:'Cement Board', type:'Exterior',   thick:'15mm', unit:'Ù„ÙˆØ­', price:110, note:''},
  {cat:'Cement Board', type:'Fire-Resistant', thick:'10mm', unit:'Ù„ÙˆØ­', price:105, note:''},
  {cat:'Cement Board', type:'Fire-Resistant', thick:'12mm', unit:'Ù„ÙˆØ­', price:120, note:''},
  {cat:'Cement Board', type:'Waterproof', thick:'12mm', unit:'Ù„ÙˆØ­', price:115, note:''},
  {cat:'Gypsum Board', type:'Regular',    thick:'12.5mm', unit:'Ù„ÙˆØ­', price:30,  note:'Ø³Ø¹Ø± Ø§Ù„Ù„ÙˆØ­'},
  {cat:'Gypsum Board', type:'Moisture Resistant', thick:'12.5mm', unit:'Ù„ÙˆØ­', price:45, note:''},
  {cat:'Gypsum Board', type:'Fire Rated', thick:'12.5mm', unit:'Ù„ÙˆØ­', price:55,  note:''},
  {cat:'Insulation',   type:'Rockwool',   thick:'50mm', unit:'Ù…Â²',  price:55,  note:'Ù„Ù„Ù…ØªØ± Ø§Ù„Ù…Ø±Ø¨Ø¹'},
  {cat:'Insulation',   type:'Rockwool',   thick:'75mm', unit:'Ù…Â²',  price:70,  note:''},
  {cat:'Insulation',   type:'Rockwool',   thick:'100mm',unit:'Ù…Â²',  price:90,  note:''},
  {cat:'Insulation',   type:'Glasswool',  thick:'50mm', unit:'Ù…Â²',  price:45,  note:''},
  {cat:'Insulation',   type:'Glasswool',  thick:'75mm', unit:'Ù…Â²',  price:60,  note:''},
  {cat:'Insulation',   type:'XPS Foam',   thick:'50mm', unit:'Ù…Â²',  price:65,  note:''},
  {cat:'Insulation',   type:'XPS Foam',   thick:'75mm', unit:'Ù…Â²',  price:85,  note:''},
  {cat:'Glass',        type:'Clear',      thick:'6mm',  unit:'Ù…Â²',  price:90,  note:'Ù„Ù„Ù…ØªØ± Ø§Ù„Ù…Ø±Ø¨Ø¹'},
  {cat:'Glass',        type:'Clear',      thick:'8mm',  unit:'Ù…Â²',  price:110, note:''},
  {cat:'Glass',        type:'Tinted',     thick:'6mm',  unit:'Ù…Â²',  price:110, note:''},
  {cat:'Glass',        type:'Tinted',     thick:'8mm',  unit:'Ù…Â²',  price:130, note:''},
  {cat:'Glass',        type:'Tempered',   thick:'8mm',  unit:'Ù…Â²',  price:140, note:''},
  {cat:'Glass',        type:'Tempered',   thick:'12mm', unit:'Ù…Â²',  price:170, note:''},
  {cat:'Glass',        type:'Double-Glazed', thick:'12mm', unit:'Ù…Â²', price:200, note:''},
  {cat:'Roof Panel',   type:'Sandwich Panel', thick:'50mm',  unit:'Ù…Â²', price:100, note:'Ù„Ù„Ù…ØªØ± Ø§Ù„Ù…Ø±Ø¨Ø¹'},
  {cat:'Roof Panel',   type:'Sandwich Panel', thick:'75mm',  unit:'Ù…Â²', price:130, note:''},
  {cat:'Roof Panel',   type:'Sandwich Panel', thick:'100mm', unit:'Ù…Â²', price:112, note:''},
  {cat:'Roof Panel',   type:'Shinko',     thick:'Standard', unit:'Ù…Â²', price:80,  note:''},
  {cat:'Roof Panel',   type:'Metal Sheet',thick:'0.5mm', unit:'Ù…Â²',  price:70,  note:''},
  {cat:'Roof Panel',   type:'Metal Sheet',thick:'0.7mm', unit:'Ù…Â²',  price:85,  note:''},
];
const DEFAULT_IDB = [
  {type:'ØªÙŠÙˆØ¨',    size:'10*10',  thick:'1.25', len:6, price:84},
  {type:'ØªÙŠÙˆØ¨',    size:'20*20',  thick:'1.25', len:6, price:120},
  {type:'ØªÙŠÙˆØ¨',    size:'30*60',  thick:'1.25', len:6, price:30},
  {type:'ØªÙŠÙˆØ¨',    size:'40*80',  thick:'1.5',  len:6, price:40},
  {type:'Ø¬Ø³Ø± H',   size:'10*16',  thick:'10',   len:6, price:230},
  {type:'Ø¬Ø³Ø± H',   size:'15*20',  thick:'12',   len:6, price:320},
  {type:'Ø²Ø§ÙˆÙŠØ©',   size:'40*40',  thick:'4',    len:6, price:45},
  {type:'Ø²Ø§ÙˆÙŠØ©',   size:'50*50',  thick:'5',    len:6, price:65},
  {type:'Ù…Ø¬Ø±Ù‰ C',  size:'10*5',   thick:'2',    len:6, price:55},
  {type:'Ù…Ø¬Ø±Ù‰ C',  size:'15*7',   thick:'2.5',  len:6, price:75},
];
const DEFAULT_MATS = [
  {name:'Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©', type:'Exterior',        thick:'12mm', price:65, unit:'Ù„ÙˆØ­', qty:0, note:'ØªÙ„Ù‚Ø§Ø¦ÙŠ (0.35 Ù„ÙˆØ­/Ù…Â²)', autoQty:'wallsNetBoards'},
  {name:'Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø¯Ø§Ø®Ù„ÙŠØ©', type:'Standard',        thick:'9mm',  price:45, unit:'Ù„ÙˆØ­', qty:0, note:'ØªÙ„Ù‚Ø§Ø¦ÙŠ (0.35 Ù„ÙˆØ­/Ù…Â²)', autoQty:'wallsNetBoards'},
  {name:'Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ (Ø¬Ø¯Ø±Ø§Ù†)',    type:'Rockwool',         thick:'50mm', price:55, unit:'Ù…Â²',  qty:0,  note:'ØªÙ„Ù‚Ø§Ø¦ÙŠ',         autoQty:'wallsNet'},
  {name:'Ø²Ø¬Ø§Ø¬ (Ù†ÙˆØ§ÙØ°/Ø£Ø¨ÙˆØ§Ø¨)',   type:'Tempered',         thick:'12mm', price:170,unit:'Ù…Â²',  qty:0,  note:'ØªÙ„Ù‚Ø§Ø¦ÙŠ',         autoQty:'glassArea'},
  {name:'Ø³Ù‚Ù (Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø¨Ø§Ù†Ù„)',   type:'Sandwich Panel',   thick:'100mm',price:112,unit:'Ù…Â²',  qty:0,  note:'ØªÙ„Ù‚Ø§Ø¦ÙŠ',         autoQty:'roof'},
  {name:'Ù…Ø³Ø§Ù…ÙŠØ± ÙˆØ¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª',    type:'â€”',                thick:'â€”',    price:15, unit:'Ù…Â²',  qty:0,  note:'ØªÙ‚Ø¯ÙŠØ± 15 Ø±.Ø³/Ù…Â²',autoQty:'totalSurface'},
  {name:'Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¯Ù‡Ø§Ù†',         type:'â€”',                thick:'â€”',    price:25, unit:'Ù…Â²',  qty:0,  note:'ØªÙ‚Ø¯ÙŠØ± 25 Ø±.Ø³/Ù…Â²',autoQty:'wallsNet'},
];
const DEFAULT_IRONS = [
  {type:'ØªÙŠÙˆØ¨',  size:'10*10',  thick:'1.25', len:6, price:84,  qty:4},
  {type:'ØªÙŠÙˆØ¨',  size:'30*60',  thick:'1.25', len:6, price:30,  qty:6},
  {type:'Ø¬Ø³Ø± H', size:'10*16',  thick:'10',   len:6, price:230, qty:1},
];
const DEFAULT_LABS = [
  {name:'ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ', desc:'Ù„Ø­Ø§Ù… + ØªØ±ÙƒÙŠØ¨',      price:50, unit:'Ù…Â²', note:'ØªÙ‚Ø¯ÙŠØ± 50 Ø±.Ø³/Ù…Â²', autoQty:'floor'},
  {name:'ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ø­ ÙˆØ§Ù„Ø¹Ø²Ù„', desc:'Ø£Ù„ÙˆØ§Ø­ + Ø¹Ø²Ù„',        price:35, unit:'Ù…Â²', note:'ØªÙ‚Ø¯ÙŠØ± 35 Ø±.Ø³/Ù…Â²', autoQty:'totalSurface'},
  {name:'ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø³Ù‚Ù',          desc:'Ø³Ø§Ù†Ø¯ÙˆØªØ´ / Ø´ÙŠÙ†ÙƒÙˆ',    price:40, unit:'Ù…Â²', note:'ØªÙ‚Ø¯ÙŠØ± 40 Ø±.Ø³/Ù…Â²', autoQty:'roof'},
];
const DEFAULT_EMPLOYEES = [
  {name:'ÙŠÙˆØ³Ù',role:'Ù…Ø¯ÙŠØ±',salary:2200},
  {name:'Ø¹Ø§Ø±Ù',role:'Ø­Ø¯Ø§Ø¯',salary:1800},
  {name:'Ø°Ùˆ Ø§Ù„ÙÙ‚Ø§Ø±',role:'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ',salary:1800},
];

// â”€â”€â”€ LIVE DATA ARRAYS (populated from SQLite) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mdb = [], idb = [], mats = [], irons = [], labs = [];

let C = {};
function dims(){
  const L=+v('i_L'),W=+v('i_W'),H=+v('i_H');
  const gL=+v('i_gL'),gW=+v('i_gW'),gN=+v('i_gN');
  C.floor=L*W; C.peri=2*(L+W); C.wallsGross=C.peri*H;
  C.glassArea=gL*gW*gN; C.wallsNet=C.wallsGross-C.glassArea;
  C.roof=C.floor; C.totalSurface=C.wallsGross+C.floor;
}
function v(id){return document.getElementById(id)?.value||0}
function fmt(n){return (n==null||isNaN(n))?'0':Number(n).toLocaleString('ar-SA',{maximumFractionDigits:2})}
function autoQ(key){
  if(!key) return null;
  if(key==='wallsNetBoards') return C.wallsNet?Math.ceil(C.wallsNet*0.347):0;
  return C[key]!=null?C[key]:0;
}

function goTo(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('pg_'+id).classList.add('show');
  const idx=['calc','projects','employees','mdb','idb','inst'].indexOf(id);
  document.querySelectorAll('.nav button')[idx].classList.add('active');
  if(id==='calc') calc();
  if(id==='mdb') renderMdb();
  if(id==='idb') renderIdb();
  if(id==='employees'){renderEmployees();renderCarRecords();}
  if(id==='projects') renderProjects();
}

function calc(){
  dims();
  document.getElementById('o_floor').textContent=fmt(C.floor);
  document.getElementById('o_peri').textContent=fmt(C.peri);
  document.getElementById('o_wG').textContent=fmt(C.wallsGross);
  document.getElementById('o_glass').textContent=fmt(C.glassArea);
  document.getElementById('o_wN').textContent=fmt(C.wallsNet);
  document.getElementById('o_roof').textContent=fmt(C.roof);
  renderMats(); renderIrons();
  let matT=0,ironT=0;
  mats.forEach(m=>{let q=m.autoQty?autoQ(m.autoQty):m.qty; matT+=m.price*q;});
  irons.forEach(it=>ironT+=it.price*it.qty);
  document.getElementById('o_ironT').textContent=fmt(ironT);
  document.getElementById('s_mat').textContent=fmt(matT);
  document.getElementById('s_iron').textContent=fmt(ironT);
  const grand=matT+ironT, perM2=C.floor?grand/C.floor:0, pct=+v('i_profit'), profAmt=grand*pct/100;
  document.getElementById('s_total').textContent=fmt(grand);
  document.getElementById('s_m2').textContent=fmt(perM2);
  document.getElementById('s_profAmt').textContent=fmt(profAmt)+' Ø±.Ø³';
  document.getElementById('s_sale').textContent=fmt(grand+profAmt)+' Ø±.Ø³';
  debouncedSave();
}

// Debounced save to avoid excessive writes during typing
let _saveTimer=null;
function debouncedSave(){if(_saveTimer)clearTimeout(_saveTimer);_saveTimer=setTimeout(()=>{saveToDB();},1500);}

function renderMats(){
  const tb=document.getElementById('tb_mat');
  const catMap={'Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©':'Cement Board','Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø¯Ø§Ø®Ù„ÙŠØ©':'Cement Board','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ (Ø¬Ø¯Ø±Ø§Ù†)':'Insulation','Ø²Ø¬Ø§Ø¬ (Ù†ÙˆØ§ÙØ°/Ø£Ø¨ÙˆØ§Ø¨)':'Glass','Ø³Ù‚Ù (Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø¨Ø§Ù†Ù„)':'Roof Panel'};
  tb.innerHTML=mats.map((m,i)=>{
    const q=m.autoQty?autoQ(m.autoQty):m.qty, tot=m.price*q;
    const cat=catMap[m.name]||'';
    const types=[...new Set(mdb.filter(r=>r.cat===cat).map(r=>r.type))];
    const thicks=[...new Set(mdb.filter(r=>r.cat===cat&&r.type===m.type).map(r=>r.thick))];
    let typeOpts=types.length?types.map(t=>`<option value="${t}" ${m.type===t?'selected':''}>${t}</option>`).join(''):`<option>${m.type}</option>`;
    let thickOpts=thicks.length?thicks.map(t=>`<option value="${t}" ${m.thick===t?'selected':''}>${t}</option>`).join(''):`<option>${m.thick}</option>`;
    return `<tr><td class="rn">${i+1}</td><td><input type="text" value="${m.name}" oninput="mats[${i}].name=this.value;calc()"></td><td>${types.length?`<select onchange="mats[${i}].type=this.value;syncPrice(${i});calc()">`+typeOpts+'</select>':`<input type="text" value="${m.type}" oninput="mats[${i}].type=this.value">`}</td><td>${thicks.length?`<select onchange="mats[${i}].thick=this.value;syncPrice(${i});calc()">`+thickOpts+'</select>':`<input type="text" value="${m.thick}" oninput="mats[${i}].thick=this.value">`}</td><td class="price-cell"><input type="number" value="${m.price}" oninput="mats[${i}].price=+this.value;calc()"></td><td><input type="text" value="${m.unit}" readonly style="color:var(--dim);font-weight:400;pointer-events:none"></td><td>${m.autoQty?`<input type="number" class="ro" value="${fmt(q)}" readonly>`:`<input type="number" value="${q}" oninput="mats[${i}].qty=+this.value;calc()">`}</td><td><input type="text" class="ro" value="${fmt(tot)}" readonly></td><td class="nc">${m.note}</td><td><button class="btn-del" onclick="mats.splice(${i},1);calc()">Ã—</button></td></tr>`;
  }).join('');
}
function syncPrice(i){const m=mats[i];const catMap={'Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©':'Cement Board','Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø¯Ø§Ø®Ù„ÙŠØ©':'Cement Board','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ (Ø¬Ø¯Ø±Ø§Ù†)':'Insulation','Ø²Ø¬Ø§Ø¬ (Ù†ÙˆØ§ÙØ°/Ø£Ø¨ÙˆØ§Ø¨)':'Glass','Ø³Ù‚Ù (Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø¨Ø§Ù†Ù„)':'Roof Panel'};const cat=catMap[m.name];const match=mdb.find(r=>r.cat===cat&&r.type===m.type&&r.thick===m.thick);if(match)m.price=match.price;}
function addMat(){mats.push({name:'Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©',type:'â€”',thick:'â€”',price:0,unit:'Ù…Â²',qty:0,note:'',autoQty:false});calc();saveToDB();}

function renderIrons(){
  const tb=document.getElementById('tb_iron'), types=[...new Set(idb.map(r=>r.type))];
  tb.innerHTML=irons.map((it,i)=>{
    const tot=it.price*it.qty, sizes=[...new Set(idb.filter(r=>r.type===it.type).map(r=>r.size))];
    let typeOpts=types.map(t=>`<option value="${t}" ${it.type===t?'selected':''}>${t}</option>`).join('');
    let sizeOpts=sizes.length?sizes.map(s=>`<option value="${s}" ${it.size===s?'selected':''}>${s}</option>`).join(''):`<option>${it.size}</option>`;
    return `<tr><td class="rn">${i+1}</td><td><select onchange="irons[${i}].type=this.value;syncIronPrice(${i});calc()">${typeOpts}</select></td><td>${sizes.length?`<select onchange="irons[${i}].size=this.value;syncIronPrice(${i});calc()">${sizeOpts}</select>`:`<input type="text" value="${it.size}" oninput="irons[${i}].size=this.value;calc()">`}</td><td><input type="text" value="${it.thick}" readonly style="color:var(--dim);font-weight:400;pointer-events:none"></td><td><input type="text" value="${it.len}" readonly style="color:var(--dim);font-weight:400;pointer-events:none"></td><td class="price-cell"><input type="number" value="${it.price}" oninput="irons[${i}].price=+this.value;calc()"></td><td><input type="number" value="${it.qty}" oninput="irons[${i}].qty=+this.value;calc()"></td><td><input type="text" class="ro" value="${fmt(tot)}" readonly></td><td><button class="btn-del" onclick="irons.splice(${i},1);calc()">Ã—</button></td></tr>`;
  }).join('');
}
function syncIronPrice(i){const it=irons[i];const match=idb.find(r=>r.type===it.type&&r.size===it.size);if(match){it.price=match.price;it.thick=match.thick;it.len=match.len;}}
function addIron(){irons.push({type:idb[0].type,size:idb[0].size,thick:idb[0].thick,len:idb[0].len,price:idb[0].price,qty:0});calc();saveToDB();}

function renderLabs(){const tb=document.getElementById('tb_lab');tb.innerHTML=labs.map((lb,i)=>{const q=lb.autoQty?autoQ(lb.autoQty):0,tot=lb.price*q;return `<tr><td><input type="text" value="${lb.name}" oninput="labs[${i}].name=this.value;calc()"></td><td><input type="text" value="${lb.desc}" oninput="labs[${i}].desc=this.value"></td><td class="price-cell"><input type="number" value="${lb.price}" oninput="labs[${i}].price=+this.value;calc()"></td><td><input type="text" value="${lb.unit}" readonly style="color:var(--dim);font-weight:400;pointer-events:none"></td><td><input type="number" class="ro" value="${fmt(q)}" readonly></td><td><input type="text" class="ro" value="${fmt(tot)}" readonly></td><td class="nc">${lb.note}</td><td><button class="btn-del" onclick="labs.splice(${i},1);calc()">Ã—</button></td></tr>`;}).join('');}
function addLab(){labs.push({name:'Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯',desc:'â€”',price:0,unit:'Ù…Â²',note:'',autoQty:false});calc();}

function renderMdb(){const tb=document.getElementById('tb_mdb');tb.innerHTML=mdb.map((r,i)=>`<tr><td class="rn">${i+1}</td><td><input type="text" value="${r.cat}" oninput="mdb[${i}].cat=this.value;renderMdb();calc()"></td><td><input type="text" value="${r.type}" oninput="mdb[${i}].type=this.value;renderMdb();calc()"></td><td><input type="text" value="${r.thick}" oninput="mdb[${i}].thick=this.value;renderMdb();calc()"></td><td><input type="text" value="${r.unit}" oninput="mdb[${i}].unit=this.value;debouncedSave()"></td><td class="price-cell"><input type="number" value="${r.price}" oninput="mdb[${i}].price=+this.value;syncAllFromMdb();calc()"></td><td class="nc">${r.note}</td><td><button class="btn-del" onclick="mdb.splice(${i},1);renderMdb();calc()">Ã—</button></td></tr>`).join('');}
function syncAllFromMdb(){const catMap={'Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©':'Cement Board','Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ© Ø¯Ø§Ø®Ù„ÙŠØ©':'Cement Board','Ø¹Ø²Ù„ Ø­Ø±Ø§Ø±ÙŠ (Ø¬Ø¯Ø±Ø§Ù†)':'Insulation','Ø²Ø¬Ø§Ø¬ (Ù†ÙˆØ§ÙØ°/Ø£Ø¨ÙˆØ§Ø¨)':'Glass','Ø³Ù‚Ù (Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø¨Ø§Ù†Ù„)':'Roof Panel'};mats.forEach(m=>{const cat=catMap[m.name];if(!cat)return;const match=mdb.find(r=>r.cat===cat&&r.type===m.type&&r.thick===m.thick);if(match)m.price=match.price;});}
function addMdbRow(){mdb.push({cat:'Cement Board',type:'Standard',thick:'6mm',unit:'Ù„ÙˆØ­',price:0,note:''});renderMdb();saveToDB();}

function renderIdb(){const tb=document.getElementById('tb_idb');tb.innerHTML=idb.map((r,i)=>`<tr><td class="rn">${i+1}</td><td><input type="text" value="${r.type}" oninput="idb[${i}].type=this.value;renderIdb();calc()"></td><td><input type="text" value="${r.size}" oninput="idb[${i}].size=this.value;renderIdb();calc()"></td><td><input type="text" value="${r.thick}" oninput="idb[${i}].thick=this.value;debouncedSave()"></td><td><input type="number" value="${r.len}" oninput="idb[${i}].len=+this.value;debouncedSave()"></td><td class="price-cell"><input type="number" value="${r.price}" oninput="idb[${i}].price=+this.value;syncAllFromIdb();calc()"></td><td><button class="btn-del" onclick="idb.splice(${i},1);renderIdb();calc()">Ã—</button></td></tr>`).join('');}
function syncAllFromIdb(){irons.forEach(it=>{const match=idb.find(r=>r.type===it.type&&r.size===it.size);if(match)it.price=match.price;});}
function addIdbRow(){idb.push({type:'ØªÙŠÙˆØ¨',size:'â€”',thick:'â€”',len:6,price:0});renderIdb();saveToDB();}

// â”€â”€â”€ EMPLOYEE MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let employees=[];
let carRecords=[];
let savedProjects=[];

// â•â•â• SQLite SCHEMA & PERSISTENCE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB_NAME='steel_calc_db';
const IDB_STORE='sqlite_store';
const IDB_KEY='main_db';

function createSchema(){
  DB.run(`CREATE TABLE IF NOT EXISTS materials_ref (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    cat TEXT, type TEXT, thick TEXT, unit TEXT, price REAL, note TEXT
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS iron_ref (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    type TEXT, size TEXT, thick TEXT, len REAL, price REAL
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS calc_materials (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT, type TEXT, thick TEXT, price REAL, unit TEXT, qty REAL, note TEXT, autoQty TEXT
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS calc_irons (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    type TEXT, size TEXT, thick TEXT, len REAL, price REAL, qty REAL
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS calc_labs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT, descr TEXT, price REAL, unit TEXT, note TEXT, autoQty TEXT
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS employees (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT, role TEXT, salary REAL
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS employee_tools (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    employee_id INTEGER, name TEXT, value REAL, date TEXT,
    FOREIGN KEY(employee_id) REFERENCES employees(id)
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS car_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date TEXT, type TEXT, details TEXT, amount REAL, odometer TEXT
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS projects (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER UNIQUE, name TEXT, date TEXT, month TEXT,
    dim_l REAL, dim_w REAL, dim_h REAL,
    baseCost REAL, profitPercent REAL, baseProfit REAL, salePrice REAL,
    status TEXT, blueprint TEXT, profit REAL, totalCost REAL
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS project_materials (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER, cat TEXT, name TEXT, type TEXT, thick TEXT,
    price REAL, unit TEXT, qty REAL, note TEXT, autoQty TEXT,
    FOREIGN KEY(project_id) REFERENCES projects(project_id)
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS project_irons (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER, type TEXT, size TEXT, thick TEXT, len REAL, price REAL, qty REAL,
    FOREIGN KEY(project_id) REFERENCES projects(project_id)
  )`);
  DB.run(`CREATE TABLE IF NOT EXISTS project_additional_costs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER, cost_type TEXT, data_json TEXT,
    FOREIGN KEY(project_id) REFERENCES projects(project_id)
  )`);
}

function seedDefaults(){
  // Only seed if tables are empty
  const mc=DB.exec("SELECT COUNT(*) as c FROM materials_ref");
  if(mc[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO materials_ref(cat,type,thick,unit,price,note) VALUES(?,?,?,?,?,?)");
    DEFAULT_MDB.forEach(r=>{stmt.run([r.cat,r.type,r.thick,r.unit,r.price,r.note]);});stmt.free();
  }
  const ic=DB.exec("SELECT COUNT(*) as c FROM iron_ref");
  if(ic[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO iron_ref(type,size,thick,len,price) VALUES(?,?,?,?,?)");
    DEFAULT_IDB.forEach(r=>{stmt.run([r.type,r.size,r.thick,r.len,r.price]);});stmt.free();
  }
  const cc=DB.exec("SELECT COUNT(*) as c FROM calc_materials");
  if(cc[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO calc_materials(name,type,thick,price,unit,qty,note,autoQty) VALUES(?,?,?,?,?,?,?,?)");
    DEFAULT_MATS.forEach(r=>{stmt.run([r.name,r.type,r.thick,r.price,r.unit,r.qty,r.note,r.autoQty||'']);});stmt.free();
  }
  const ci=DB.exec("SELECT COUNT(*) as c FROM calc_irons");
  if(ci[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO calc_irons(type,size,thick,len,price,qty) VALUES(?,?,?,?,?,?)");
    DEFAULT_IRONS.forEach(r=>{stmt.run([r.type,r.size,r.thick,r.len,r.price,r.qty]);});stmt.free();
  }
  const cl=DB.exec("SELECT COUNT(*) as c FROM calc_labs");
  if(cl[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO calc_labs(name,descr,price,unit,note,autoQty) VALUES(?,?,?,?,?,?)");
    DEFAULT_LABS.forEach(r=>{stmt.run([r.name,r.desc,r.price,r.unit,r.note,r.autoQty||'']);});stmt.free();
  }
  const ec=DB.exec("SELECT COUNT(*) as c FROM employees");
  if(ec[0].values[0][0]===0){
    const stmt=DB.prepare("INSERT INTO employees(name,role,salary) VALUES(?,?,?)");
    DEFAULT_EMPLOYEES.forEach(r=>{stmt.run([r.name,r.role,r.salary]);});stmt.free();
  }
}

// â”€â”€â”€ Load arrays from SQLite â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadFromDB(){
  mdb=[];idb=[];mats=[];irons=[];labs=[];employees=[];carRecords=[];savedProjects=[];

  // materials_ref
  let res=DB.exec("SELECT cat,type,thick,unit,price,note FROM materials_ref ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{mdb.push({cat:r[0],type:r[1],thick:r[2],unit:r[3],price:r[4],note:r[5]||''});});

  // iron_ref
  res=DB.exec("SELECT type,size,thick,len,price FROM iron_ref ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{idb.push({type:r[0],size:r[1],thick:r[2],len:r[3],price:r[4]});});

  // calc_materials
  res=DB.exec("SELECT name,type,thick,price,unit,qty,note,autoQty FROM calc_materials ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{mats.push({name:r[0],type:r[1],thick:r[2],price:r[3],unit:r[4],qty:r[5],note:r[6]||'',autoQty:r[7]||false});});

  // calc_irons
  res=DB.exec("SELECT type,size,thick,len,price,qty FROM calc_irons ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{irons.push({type:r[0],size:r[1],thick:r[2],len:r[3],price:r[4],qty:r[5]});});

  // calc_labs
  res=DB.exec("SELECT name,descr,price,unit,note,autoQty FROM calc_labs ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{labs.push({name:r[0],desc:r[1],price:r[2],unit:r[3],note:r[4]||'',autoQty:r[5]||false});});

  // employees + tools
  res=DB.exec("SELECT id,name,role,salary FROM employees ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{
    const eid=r[0],tools=[];
    const tr=DB.exec("SELECT name,value,date FROM employee_tools WHERE employee_id="+eid+" ORDER BY id");
    if(tr.length)tr[0].values.forEach(t=>{tools.push({name:t[0],value:t[1],date:t[2]});});
    employees.push({_id:eid,name:r[1],role:r[2],salary:r[3],tools:tools});
  });

  // car_records
  res=DB.exec("SELECT date,type,details,amount,odometer FROM car_records ORDER BY id");
  if(res.length)res[0].values.forEach(r=>{carRecords.push({date:r[0],type:r[1],details:r[2],amount:r[3],odometer:r[4]||''});});

  // projects
  res=DB.exec("SELECT project_id,name,date,month,dim_l,dim_w,dim_h,baseCost,profitPercent,baseProfit,salePrice,status,blueprint,profit,totalCost FROM projects ORDER BY project_id");
  if(res.length)res[0].values.forEach(r=>{
    const pid=r[0];
    // project materials
    const pm=[];
    const pmr=DB.exec("SELECT cat,name,type,thick,price,unit,qty,note,autoQty FROM project_materials WHERE project_id="+pid+" ORDER BY id");
    if(pmr.length)pmr[0].values.forEach(m=>{pm.push({cat:m[0],name:m[1]||'',type:m[2],thick:m[3],price:m[4],unit:m[5],qty:m[6],note:m[7]||'',autoQty:m[8]||false});});
    // project irons
    const pi=[];
    const pir=DB.exec("SELECT type,size,thick,len,price,qty FROM project_irons WHERE project_id="+pid+" ORDER BY id");
    if(pir.length)pir[0].values.forEach(ir=>{pi.push({type:ir[0],size:ir[1],thick:ir[2],len:ir[3],price:ir[4],qty:ir[5]});});
    // additional costs
    const ac={transport:[],dailyWorkers:[],materials:[],other:[]};
    const acr=DB.exec("SELECT cost_type,data_json FROM project_additional_costs WHERE project_id="+pid+" ORDER BY id");
    if(acr.length)acr[0].values.forEach(a=>{try{ac[a[0]].push(JSON.parse(a[1]));}catch(e){}});
    savedProjects.push({id:pid,name:r[1],date:r[2],month:r[3],dimensions:{L:r[4],W:r[5],H:r[6]},baseCost:r[7],profitPercent:r[8],baseProfit:r[9],salePrice:r[10],status:r[11],blueprint:r[12],profit:r[13],totalCost:r[14],materials:pm,irons:pi,additionalCosts:ac});
  });
}

// â”€â”€â”€ Save arrays to SQLite â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveToDB(){
  if(!DB)return;
  // materials_ref
  DB.run("DELETE FROM materials_ref");
  const s1=DB.prepare("INSERT INTO materials_ref(cat,type,thick,unit,price,note) VALUES(?,?,?,?,?,?)");
  mdb.forEach(r=>{s1.run([r.cat,r.type,r.thick,r.unit,r.price,r.note||'']);});s1.free();

  // iron_ref
  DB.run("DELETE FROM iron_ref");
  const s2=DB.prepare("INSERT INTO iron_ref(type,size,thick,len,price) VALUES(?,?,?,?,?)");
  idb.forEach(r=>{s2.run([r.type,r.size,r.thick,r.len,r.price]);});s2.free();

  // calc_materials
  DB.run("DELETE FROM calc_materials");
  const s3=DB.prepare("INSERT INTO calc_materials(name,type,thick,price,unit,qty,note,autoQty) VALUES(?,?,?,?,?,?,?,?)");
  mats.forEach(r=>{s3.run([r.name,r.type,r.thick,r.price,r.unit,r.qty,r.note||'',r.autoQty||'']);});s3.free();

  // calc_irons
  DB.run("DELETE FROM calc_irons");
  const s4=DB.prepare("INSERT INTO calc_irons(type,size,thick,len,price,qty) VALUES(?,?,?,?,?,?)");
  irons.forEach(r=>{s4.run([r.type,r.size,r.thick,r.len,r.price,r.qty]);});s4.free();

  // calc_labs
  DB.run("DELETE FROM calc_labs");
  const s5=DB.prepare("INSERT INTO calc_labs(name,descr,price,unit,note,autoQty) VALUES(?,?,?,?,?,?)");
  labs.forEach(r=>{s5.run([r.name,r.desc||'',r.price,r.unit,r.note||'',r.autoQty||'']);});s5.free();

  // employees + tools
  DB.run("DELETE FROM employee_tools");
  DB.run("DELETE FROM employees");
  const se=DB.prepare("INSERT INTO employees(name,role,salary) VALUES(?,?,?)");
  const st=DB.prepare("INSERT INTO employee_tools(employee_id,name,value,date) VALUES(?,?,?,?)");
  employees.forEach(emp=>{
    se.run([emp.name,emp.role,emp.salary]);
    const eid=DB.exec("SELECT last_insert_rowid()")[0].values[0][0];
    emp._id=eid;
    (emp.tools||[]).forEach(t=>{st.run([eid,t.name,t.value,t.date]);});
  });se.free();st.free();

  // car_records
  DB.run("DELETE FROM car_records");
  const sc=DB.prepare("INSERT INTO car_records(date,type,details,amount,odometer) VALUES(?,?,?,?,?)");
  carRecords.forEach(r=>{sc.run([r.date,r.type,r.details,r.amount,r.odometer||'']);});sc.free();

  // projects
  DB.run("DELETE FROM project_additional_costs");
  DB.run("DELETE FROM project_irons");
  DB.run("DELETE FROM project_materials");
  DB.run("DELETE FROM projects");
  const sp=DB.prepare("INSERT INTO projects(project_id,name,date,month,dim_l,dim_w,dim_h,baseCost,profitPercent,baseProfit,salePrice,status,blueprint,profit,totalCost) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
  const spm=DB.prepare("INSERT INTO project_materials(project_id,cat,name,type,thick,price,unit,qty,note,autoQty) VALUES(?,?,?,?,?,?,?,?,?,?)");
  const spi=DB.prepare("INSERT INTO project_irons(project_id,type,size,thick,len,price,qty) VALUES(?,?,?,?,?,?,?)");
  const sac=DB.prepare("INSERT INTO project_additional_costs(project_id,cost_type,data_json) VALUES(?,?,?)");
  savedProjects.forEach(p=>{
    sp.run([p.id,p.name,p.date,p.month,p.dimensions.L,p.dimensions.W,p.dimensions.H||0,p.baseCost||0,p.profitPercent||0,p.baseProfit||0,p.salePrice||0,p.status||'Ø¬Ø§Ø±ÙŠ',p.blueprint||null,p.profit||0,p.totalCost||0]);
    (p.materials||[]).forEach(m=>{spm.run([p.id,m.cat||'',m.name||'',m.type,m.thick,m.price||0,m.unit||'',m.qty||0,m.note||'',m.autoQty||'']);});
    (p.irons||[]).forEach(ir=>{spi.run([p.id,ir.type,ir.size,ir.thick,ir.len||0,ir.price||0,ir.qty||0]);});
    if(p.additionalCosts){
      ['transport','dailyWorkers','materials','other'].forEach(ct=>{
        (p.additionalCosts[ct]||[]).forEach(item=>{sac.run([p.id,ct,JSON.stringify(item)]);});
      });
    }
  });sp.free();spm.free();spi.free();sac.free();

  persistDBToIndexedDB();
}

// â”€â”€â”€ IndexedDB persistence for SQLite binary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openIDB(){
  return new Promise((resolve,reject)=>{
    const req=indexedDB.open(DB_NAME,1);
    req.onupgradeneeded=()=>{req.result.createObjectStore(IDB_STORE);};
    req.onsuccess=()=>resolve(req.result);
    req.onerror=()=>reject(req.error);
  });
}
async function persistDBToIndexedDB(){
  try{
    const data=DB.export();
    const idbConn=await openIDB();
    const tx=idbConn.transaction(IDB_STORE,'readwrite');
    tx.objectStore(IDB_STORE).put(data,IDB_KEY);
    tx.oncomplete=()=>{idbConn.close();showDBStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸');};
    tx.onerror=()=>{idbConn.close();};
  }catch(e){console.warn('IndexedDB save failed:',e);}
}
async function loadDBFromIndexedDB(){
  try{
    const idbConn=await openIDB();
    return new Promise((resolve,reject)=>{
      const tx=idbConn.transaction(IDB_STORE,'readonly');
      const req=tx.objectStore(IDB_STORE).get(IDB_KEY);
      req.onsuccess=()=>{idbConn.close();resolve(req.result||null);};
      req.onerror=()=>{idbConn.close();resolve(null);};
    });
  }catch(e){return null;}
}

// â”€â”€â”€ Download / Import DB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadDB(){
  if(!DB)return;
  saveToDB();
  const data=DB.export();
  const blob=new Blob([data],{type:'application/x-sqlite3'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='steel_calculator_'+new Date().toISOString().split('T')[0]+'.db';
  a.click();
  URL.revokeObjectURL(url);
  showDBStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
}
async function importDB(event){
  const file=event.target.files[0];
  if(!file)return;
  try{
    const buf=await file.arrayBuffer();
    const uArr=new Uint8Array(buf);
    DB.close();
    DB=new SQL.Database(uArr);
    loadFromDB();
    await persistDBToIndexedDB();
    calc();
    renderEmployees();renderCarRecords();renderProjects();
    showDBStatus('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
  }catch(e){
    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù: '+e.message);
  }
  event.target.value='';
}

function showDBStatus(msg){
  const el=document.getElementById('dbStatus');
  if(!el)return;
  el.textContent='âœ“ '+msg;
  el.style.display='inline';
  setTimeout(()=>{el.style.display='none';},3000);
}

// â”€â”€â”€ Migrate from localStorage to SQLite (one-time) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function migrateFromLocalStorage(){
  let migrated=false;
  try{
    const s=localStorage.getItem('employeesData');
    if(s){
      const emp=JSON.parse(s);
      if(emp&&emp.length){
        DB.run("DELETE FROM employee_tools");DB.run("DELETE FROM employees");
        const se=DB.prepare("INSERT INTO employees(name,role,salary) VALUES(?,?,?)");
        const st=DB.prepare("INSERT INTO employee_tools(employee_id,name,value,date) VALUES(?,?,?,?)");
        emp.forEach(e=>{
          se.run([e.name,e.role,e.salary]);
          const eid=DB.exec("SELECT last_insert_rowid()")[0].values[0][0];
          (e.tools||[]).forEach(t=>{st.run([eid,t.name,t.value,t.date]);});
        });se.free();st.free();migrated=true;
      }
    }
    const c=localStorage.getItem('carRecords');
    if(c){
      const cr=JSON.parse(c);
      if(cr&&cr.length){
        DB.run("DELETE FROM car_records");
        const sc=DB.prepare("INSERT INTO car_records(date,type,details,amount,odometer) VALUES(?,?,?,?,?)");
        cr.forEach(r=>{sc.run([r.date,r.type,r.details,r.amount,r.odometer||'']);});sc.free();migrated=true;
      }
    }
    const p=localStorage.getItem('savedProjects');
    if(p){
      const projs=JSON.parse(p);
      if(projs&&projs.length){
        DB.run("DELETE FROM project_additional_costs");DB.run("DELETE FROM project_irons");DB.run("DELETE FROM project_materials");DB.run("DELETE FROM projects");
        const sp=DB.prepare("INSERT INTO projects(project_id,name,date,month,dim_l,dim_w,dim_h,baseCost,profitPercent,baseProfit,salePrice,status,blueprint,profit,totalCost) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
        const spm=DB.prepare("INSERT INTO project_materials(project_id,cat,name,type,thick,price,unit,qty,note,autoQty) VALUES(?,?,?,?,?,?,?,?,?,?)");
        const spi=DB.prepare("INSERT INTO project_irons(project_id,type,size,thick,len,price,qty) VALUES(?,?,?,?,?,?,?)");
        const sac=DB.prepare("INSERT INTO project_additional_costs(project_id,cost_type,data_json) VALUES(?,?,?)");
        projs.forEach(proj=>{
          sp.run([proj.id,proj.name,proj.date,proj.month,proj.dimensions?.L||0,proj.dimensions?.W||0,proj.dimensions?.H||0,proj.baseCost||0,proj.profitPercent||0,proj.baseProfit||0,proj.salePrice||0,proj.status||'Ø¬Ø§Ø±ÙŠ',proj.blueprint||null,proj.profit||0,proj.totalCost||0]);
          (proj.materials||[]).forEach(m=>{spm.run([proj.id,m.cat||'',m.name||'',m.type||'',m.thick||'',m.price||0,m.unit||'',m.qty||0,m.note||'',m.autoQty||'']);});
          (proj.irons||[]).forEach(ir=>{spi.run([proj.id,ir.type||'',ir.size||'',ir.thick||'',ir.len||0,ir.price||0,ir.qty||0]);});
          if(proj.additionalCosts){['transport','dailyWorkers','materials','other'].forEach(ct=>{(proj.additionalCosts[ct]||[]).forEach(item=>{sac.run([proj.id,ct,JSON.stringify(item)]);});});}
        });sp.free();spm.free();spi.free();sac.free();migrated=true;
      }
    }
    if(migrated){
      // Clear old localStorage after migration
      localStorage.removeItem('employeesData');
      localStorage.removeItem('carRecords');
      localStorage.removeItem('savedProjects');
      localStorage.removeItem('ssc_mdb');
      localStorage.removeItem('ssc_idb');
      localStorage.removeItem('ssc_mats');
      localStorage.removeItem('ssc_irons');
      localStorage.removeItem('ssc_labs');
      console.log('Migration from localStorage complete');
    }
  }catch(e){console.warn('Migration error:',e);}
}

// â”€â”€â”€ Wrapper: replaces old saveEmployeeData â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveEmployeeData(){saveToDB();}
function loadEmployeeData(){/* data already loaded from SQLite in initApp */}

function renderEmployees(){const container=document.getElementById('employeesList');if(!container)return;container.innerHTML=employees.map((emp,i)=>`<div class="emp-card"><div class="emp-header"><div><div class="emp-name">${emp.name}</div><div class="emp-role">${emp.role}</div></div><div class="emp-salary">${emp.salary.toLocaleString()} Ø±.Ø³</div></div><div class="emp-section"><div class="emp-section-title">Ø§Ù„Ø¹Ù‡Ø¯ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</div>${emp.tools.length===0?'<div style="color:var(--dim);font-size:.85rem;text-align:center;padding:8px 0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø¬Ù„Ø©</div>':''}${emp.tools.map((tool,ti)=>`<div class="emp-item"><span class="tool-name">${tool.name}</span><span class="tool-date">${tool.date}</span><span class="tool-value">${tool.value.toLocaleString()} Ø±.Ø³</span><button class="btn-del" onclick="deleteTool(${i},${ti})" style="margin-right:8px">Ã—</button></div>`).join('')}<button class="btn-add" style="margin-top:10px" onclick="addTool(${i})">+ Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø©</button></div></div>`).join('');updateEmployeeSummary();}
function addTool(ei){const n=prompt('Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ø§Ø© / Ø§Ù„Ù…Ø¹Ø¯Ø©:');if(!n||!n.trim())return;const v=prompt('Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£Ø¯Ø§Ø© (Ø±.Ø³):');if(!v)return;const val=parseFloat(v);if(isNaN(val)){alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­');return;}employees[ei].tools.push({name:n.trim(),value:val,date:new Date().toISOString().split('T')[0]});saveEmployeeData();renderEmployees();}
function deleteTool(ei,ti){if(confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ØŸ')){employees[ei].tools.splice(ti,1);saveEmployeeData();renderEmployees();}}

function renderCarRecords(){const tbody=document.getElementById('carRecordsBody');if(!tbody)return;if(carRecords.length===0){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--dim);padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯</td></tr>';}else{tbody.innerHTML=carRecords.map((rec,i)=>`<tr><td>${rec.date}</td><td><span style="background:${rec.type==='Ø¨Ù†Ø²ÙŠÙ†'?'rgba(240,165,58,.15)':rec.type==='ØµÙŠØ§Ù†Ø©'?'rgba(239,83,80,.15)':'rgba(91,143,249,.15)'};padding:3px 8px;border-radius:5px;font-size:.8rem">${rec.type}</span></td><td>${rec.details}</td><td style="color:var(--amber);font-weight:700">${rec.amount.toLocaleString()}</td><td>${rec.odometer||'-'}</td><td><button class="btn-del" onclick="deleteCarRecord(${i})">Ã—</button></td></tr>`).join('');}updateCarSummary();}
function addCarRecord(){const type=prompt('Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¬Ù„:\n1. Ø¨Ù†Ø²ÙŠÙ†\n2. ØµÙŠØ§Ù†Ø©\n3. Ø£Ø®Ø±Ù‰\n\nØ§ÙƒØªØ¨ Ø§Ù„Ù†ÙˆØ¹:');if(!type||!type.trim())return;const details=prompt('ØªÙØ§ØµÙŠÙ„ / ÙˆØµÙ:');if(!details||!details.trim())return;const amount=prompt('Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³):');if(!amount)return;const amountNum=parseFloat(amount);if(isNaN(amountNum)){alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­');return;}const odometer=prompt('Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (ÙƒÙ…) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ:\n(Ø§Ø¶ØºØ· Cancel Ù„Ù„ØªØ®Ø·ÙŠ)')||'';carRecords.push({date:new Date().toISOString().split('T')[0],type:type.trim(),details:details.trim(),amount:amountNum,odometer:odometer.trim()});saveEmployeeData();renderCarRecords();}
function deleteCarRecord(i){if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')){carRecords.splice(i,1);saveEmployeeData();renderCarRecords();}}
function updateCarSummary(){let tF=0,tM=0,tO=0;carRecords.forEach(r=>{if(r.type.includes('Ø¨Ù†Ø²ÙŠÙ†'))tF+=r.amount;else if(r.type.includes('ØµÙŠØ§Ù†Ø©'))tM+=r.amount;else tO+=r.amount;});const f=document.getElementById('totalFuel'),m=document.getElementById('totalMaint'),c=document.getElementById('totalCar'),ce=document.getElementById('carExpenses');if(f)f.textContent=tF.toLocaleString();if(m)m.textContent=(tM+tO).toLocaleString();if(c)c.textContent=(tF+tM+tO).toLocaleString();if(ce)ce.textContent=(tF+tM+tO).toLocaleString();}
function updateEmployeeSummary(){let tS=employees.reduce((s,e)=>s+e.salary,0),tT=0;employees.forEach(e=>e.tools.forEach(t=>tT+=t.value));let cE=0;carRecords.forEach(r=>cE+=r.amount);const mC=tS+cE,curM=new Date().toISOString().substr(0,7);let mP=0;savedProjects.forEach(p=>{if(p.month===curM)mP+=p.profit||0;});const nP=mP-mC;const sE=document.getElementById('totalSalaries'),tE=document.getElementById('totalTools'),ceE=document.getElementById('carExpenses'),cE2=document.getElementById('monthlyCosts'),pE=document.getElementById('monthlyProfits'),nE=document.getElementById('netProfit'),msg=document.getElementById('profitMessage'),rc=document.getElementById('netResult');if(sE)sE.textContent=tS.toLocaleString();if(tE)tE.textContent=tT.toLocaleString();if(ceE)ceE.textContent=cE.toLocaleString();if(cE2)cE2.textContent=mC.toLocaleString();if(pE)pE.textContent=mP.toLocaleString();if(nE)nE.textContent=nP.toLocaleString();if(msg&&rc){if(nP>0){rc.style.background='linear-gradient(135deg,rgba(76,175,125,.12),rgba(76,175,125,.04))';rc.style.borderColor='rgba(76,175,125,.2)';nE.style.color='var(--green)';msg.innerHTML='âœ… Ù…Ù…ØªØ§Ø²! Ø­Ù‚Ù‚Øª Ø±Ø¨Ø­ ØµØ§ÙÙŠ <strong>'+nP.toLocaleString()+' Ø±.Ø³</strong> Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±';msg.style.background='rgba(76,175,125,.1)';msg.style.color='var(--green)';}else if(nP===0){rc.style.background='linear-gradient(135deg,rgba(240,165,58,.12),rgba(240,165,58,.04))';rc.style.borderColor='rgba(240,165,58,.2)';nE.style.color='var(--amber)';msg.innerHTML='âš ï¸ ØºØ·ÙŠØª Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø¨Ø§Ù„Ø¶Ø¨Ø·';msg.style.background='rgba(240,165,58,.1)';msg.style.color='var(--amber)';}else{rc.style.background='linear-gradient(135deg,rgba(239,83,80,.12),rgba(239,83,80,.04))';rc.style.borderColor='rgba(239,83,80,.2)';nE.style.color='var(--red)';msg.innerHTML='âŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ <strong>'+Math.abs(nP).toLocaleString()+' Ø±.Ø³</strong> Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØºØ·ÙŠØ© Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ';msg.style.background='rgba(239,83,80,.1)';msg.style.color='var(--red)';}}}

// â”€â”€â”€ PROJECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveProject(){const pn=prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:');if(!pn||!pn.trim())return;const tc=parseFloat(document.getElementById('s_total').textContent.replace(/,/g,''))||0;const pp=parseFloat(document.getElementById('i_profit').value)||0;const pa=parseFloat(document.getElementById('s_profAmt').textContent.replace(/[^0-9.-]/g,''))||0;const sp=parseFloat(document.getElementById('s_sale').textContent.replace(/[^0-9.-]/g,''))||0;const L=parseFloat(document.getElementById('i_L').value)||0,W=parseFloat(document.getElementById('i_W').value)||0,H=parseFloat(document.getElementById('i_H').value)||0;const mc=JSON.parse(JSON.stringify(mats)).map(mat=>{let cat='';if(mat.name.includes('Ø£Ù„ÙˆØ§Ø­ Ø£Ø³Ù…Ù†ØªÙŠØ©'))cat='Cement Board';else if(mat.name.includes('Ø¹Ø²Ù„'))cat='Insulation';else if(mat.name.includes('Ø²Ø¬Ø§Ø¬'))cat='Glass';else if(mat.name.includes('Ø³Ù‚Ù'))cat='Roof Panel';else if(mat.name.includes('Ø¬Ø¨Ø³'))cat='Gypsum Board';else cat='Other';return{...mat,cat};});const ic=JSON.parse(JSON.stringify(irons));const cm=new Date().toISOString().substr(0,7);savedProjects.push({id:Date.now(),name:pn.trim(),date:new Date().toISOString().split('T')[0],month:cm,dimensions:{L,W,H},materials:mc,irons:ic,baseCost:tc,profitPercent:pp,baseProfit:pa,salePrice:sp,status:'Ø¬Ø§Ø±ÙŠ',additionalCosts:{transport:[],dailyWorkers:[],materials:[],other:[]},blueprint:null});saveEmployeeData();alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!');updateEmployeeSummary();setTimeout(()=>goTo('projects'),100);}

function renderProjects(){const container=document.getElementById('projectsList'),noP=document.getElementById('noProjects'),ms=document.getElementById('monthSelector');if(!container)return;const sm=ms?ms.value:'all';let fp=sm==='all'?savedProjects:savedProjects.filter(p=>p.month===sm);if(fp.length===0){container.style.display='none';if(noP)noP.style.display='block';}else{container.style.display='grid';if(noP)noP.style.display='none';container.innerHTML=fp.map(proj=>{let at=0;if(proj.additionalCosts){proj.additionalCosts.transport?.forEach(t=>at+=t.amount);proj.additionalCosts.dailyWorkers?.forEach(w=>at+=w.total);proj.additionalCosts.materials?.forEach(m=>at+=m.total);proj.additionalCosts.other?.forEach(o=>at+=o.amount);}const ac=(proj.baseCost||proj.totalCost||0)+at,ap=proj.salePrice-ac;return `<div class="project-card" onclick="openProjectDetails(${proj.id})" style="cursor:pointer"><div class="project-title">${proj.name}</div><div style="display:inline-block;padding:4px 10px;background:${proj.status==='Ù…Ù†ØªÙ‡ÙŠ'?'rgba(76,175,125,.15)':'rgba(240,165,58,.15)'};border-radius:6px;font-size:.75rem;color:${proj.status==='Ù…Ù†ØªÙ‡ÙŠ'?'var(--green)':'var(--amber)'};font-weight:600;margin:8px 0">${proj.status==='Ù…Ù†ØªÙ‡ÙŠ'?'âœ…':'ğŸ”„'} ${proj.status}</div><div class="project-meta">ğŸ“… ${proj.date}</div><div class="project-meta">ğŸ“ ${proj.dimensions.L} Ã— ${proj.dimensions.W} Ù…</div><div class="project-cost">Ø§Ù„ØªÙƒÙ„ÙØ©: ${ac.toLocaleString()} Ø±.Ø³</div>${at>0?`<div class="project-meta" style="color:var(--red);font-size:.8rem">+ Ù…ØµØ§Ø±ÙŠÙ Ø¥Ø¶Ø§ÙÙŠØ©: ${at.toLocaleString()} Ø±.Ø³</div>`:''}<div class="project-profit">Ø§Ù„Ø±Ø¨Ø­: ${ap.toLocaleString()} Ø±.Ø³</div><div class="project-actions"><button onclick="event.stopPropagation();openProjectDetails(${proj.id})" style="background:var(--blue);border:none;color:#fff">ğŸ“‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button><button onclick="event.stopPropagation();deleteProject(${proj.id})" style="background:var(--red);border:none;color:#fff">ğŸ—‘ï¸</button></div></div>`;}).join('');}const tC=fp.reduce((s,p)=>{let a=0;if(p.additionalCosts){p.additionalCosts.transport?.forEach(t=>a+=t.amount);p.additionalCosts.dailyWorkers?.forEach(w=>a+=w.total);p.additionalCosts.materials?.forEach(m=>a+=m.total);p.additionalCosts.other?.forEach(o=>a+=o.amount);}return s+(p.baseCost||p.totalCost||0)+a;},0);const tP=fp.reduce((s,p)=>{let a=0;if(p.additionalCosts){p.additionalCosts.transport?.forEach(t=>a+=t.amount);p.additionalCosts.dailyWorkers?.forEach(w=>a+=w.total);p.additionalCosts.materials?.forEach(m=>a+=m.total);p.additionalCosts.other?.forEach(o=>a+=o.amount);}return s+(p.salePrice-((p.baseCost||p.totalCost||0)+a));},0);const cE=document.getElementById('projectCount'),csE=document.getElementById('totalCostsProjects'),psE=document.getElementById('totalProfitsProjects');if(cE)cE.textContent=fp.length;if(csE)csE.textContent=tC.toLocaleString();if(psE)psE.textContent=tP.toLocaleString();}
function deleteProject(id){if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ')){savedProjects=savedProjects.filter(p=>p.id!==id);saveEmployeeData();renderProjects();updateEmployeeSummary();}}

let currentProjectId=null;
function openProjectDetails(id){currentProjectId=id;const p=savedProjects.find(x=>x.id===id);if(!p)return;document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('show'));document.getElementById('pg_projectDetails').classList.add('show');document.getElementById('projectDetailTitle').textContent=p.name;document.getElementById('projectDetailMeta').textContent='ğŸ“… '+p.date+' | ğŸ“ '+p.dimensions.L+' Ã— '+p.dimensions.W+' Ù…';const sb=document.getElementById('statusToggleBtn');if(p.status==='Ù…Ù†ØªÙ‡ÙŠ'){sb.style.background='var(--amber)';sb.textContent='ğŸ”„ ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°';}else{sb.style.background='var(--green)';sb.textContent='âœ… ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰: Ù…Ù†ØªÙ‡ÙŠ';}const bp=document.getElementById('blueprintPreview');if(p.blueprint)bp.innerHTML=`<img src="${p.blueprint}" style="max-width:100%;max-height:400px;border-radius:8px">`;else bp.innerHTML='<p style="color:var(--dim);font-size:.85rem">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ø®Ø·Ø· Ø¨Ø¹Ø¯</p>';document.getElementById('detailBaseCost').textContent=(p.baseCost||0).toLocaleString();document.getElementById('detailSalePrice').textContent=p.salePrice.toLocaleString();document.getElementById('detailBaseProfit').textContent=(p.baseProfit||0).toLocaleString();renderProjectMaterials(p);renderProjectIrons(p);renderAdditionalCosts(p);updateProjectSummary(p);}

function renderProjectMaterials(p){if(!p.materials)p.materials=[];const tb=document.getElementById('projectMaterialsTable');tb.innerHTML=p.materials.map((mat,i)=>{const q=mat.qty||0,total=(mat.price||0)*q;const cats=[...new Set(mdb.map(r=>r.cat))];const catOpts=cats.map(c=>`<option value="${c}" ${mat.cat===c?'selected':''}>${c}</option>`).join('');const cc=mat.cat||cats[0];const types=[...new Set(mdb.filter(r=>r.cat===cc).map(r=>r.type))];const typeOpts=types.map(t=>`<option value="${t}" ${mat.type===t?'selected':''}>${t}</option>`).join('');const thicks=[...new Set(mdb.filter(r=>r.cat===cc&&r.type===mat.type).map(r=>r.thick))];const thickOpts=thicks.map(t=>`<option value="${t}" ${mat.thick===t?'selected':''}>${t}</option>`).join('');return `<tr><td class="rn">${i+1}</td><td><select onchange="updateProjectMaterialCat(${i},this.value)" style="min-width:150px">${catOpts}</select></td><td><select onchange="updateProjectMaterialType(${i},this.value)">${typeOpts||'<option>â€”</option>'}</select></td><td><select onchange="updateProjectMaterialThick(${i},this.value)">${thickOpts||'<option>â€”</option>'}</select></td><td class="price-cell"><input type="number" value="${mat.price}" oninput="updateProjectMaterial(${i},'price',this.value)"></td><td><input type="text" value="${mat.unit||'Ù„ÙˆØ­'}" oninput="updateProjectMaterial(${i},'unit',this.value)" style="width:60px"></td><td><input type="number" value="${q}" oninput="updateProjectMaterial(${i},'qty',this.value)"></td><td class="ro">${total.toLocaleString()}</td><td><button class="btn-del" onclick="deleteProjectMaterial(${i})">Ã—</button></td></tr>`;}).join('');document.getElementById('projectMaterialsTotal').textContent=p.materials.reduce((s,m)=>s+((m.price||0)*(m.qty||0)),0).toLocaleString();}
function updateProjectMaterialCat(i,cat){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.materials[i].cat=cat;const types=[...new Set(mdb.filter(r=>r.cat===cat).map(r=>r.type))];if(types.length>0){p.materials[i].type=types[0];const thicks=[...new Set(mdb.filter(r=>r.cat===cat&&r.type===types[0]).map(r=>r.thick))];if(thicks.length>0){p.materials[i].thick=thicks[0];const match=mdb.find(r=>r.cat===cat&&r.type===types[0]&&r.thick===thicks[0]);if(match){p.materials[i].price=match.price;p.materials[i].unit=match.unit;}}}saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}
function updateProjectMaterialType(i,type){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.materials[i].type=type;const cat=p.materials[i].cat;const thicks=[...new Set(mdb.filter(r=>r.cat===cat&&r.type===type).map(r=>r.thick))];if(thicks.length>0){p.materials[i].thick=thicks[0];const match=mdb.find(r=>r.cat===cat&&r.type===type&&r.thick===thicks[0]);if(match){p.materials[i].price=match.price;p.materials[i].unit=match.unit;}}saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}
function updateProjectMaterialThick(i,thick){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.materials[i].thick=thick;const match=mdb.find(r=>r.cat===p.materials[i].cat&&r.type===p.materials[i].type&&r.thick===thick);if(match){p.materials[i].price=match.price;p.materials[i].unit=match.unit;}saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}
function updateProjectMaterial(i,field,value){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.materials[i][field]=(field==='price'||field==='qty')?parseFloat(value)||0:value;saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}
function addProjectMaterial(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;if(!p.materials)p.materials=[];const cats=[...new Set(mdb.map(r=>r.cat))];const fc=cats[0]||'Cement Board';const types=[...new Set(mdb.filter(r=>r.cat===fc).map(r=>r.type))];const ft=types[0]||'Standard';const thicks=[...new Set(mdb.filter(r=>r.cat===fc&&r.type===ft).map(r=>r.thick))];const fth=thicks[0]||'9mm';const match=mdb.find(r=>r.cat===fc&&r.type===ft&&r.thick===fth);p.materials.push({cat:fc,type:ft,thick:fth,price:match?match.price:0,unit:match?match.unit:'Ù„ÙˆØ­',qty:0});saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}
function deleteProjectMaterial(i){if(!confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ'))return;const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.materials.splice(i,1);saveEmployeeData();renderProjectMaterials(p);updateProjectSummary(p);}

function renderProjectIrons(p){if(!p.irons)p.irons=[];const tb=document.getElementById('projectIronsTable');tb.innerHTML=p.irons.map((iron,i)=>{const total=(iron.price||0)*(iron.qty||0);return `<tr><td class="rn">${i+1}</td><td><input type="text" value="${iron.type}" oninput="updateProjectIron(${i},'type',this.value)"></td><td><input type="text" value="${iron.size}" oninput="updateProjectIron(${i},'size',this.value)"></td><td><input type="text" value="${iron.thick}" oninput="updateProjectIron(${i},'thick',this.value)"></td><td><input type="text" value="${iron.len}" oninput="updateProjectIron(${i},'len',this.value)"></td><td class="price-cell"><input type="number" value="${iron.price}" oninput="updateProjectIron(${i},'price',this.value)"></td><td><input type="number" value="${iron.qty}" oninput="updateProjectIron(${i},'qty',this.value)"></td><td class="ro">${total.toLocaleString()}</td><td><button class="btn-del" onclick="deleteProjectIron(${i})">Ã—</button></td></tr>`;}).join('');document.getElementById('projectIronsTotal').textContent=p.irons.reduce((s,ir)=>s+((ir.price||0)*(ir.qty||0)),0).toLocaleString();}
function updateProjectIron(i,field,value){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.irons[i][field]=(field==='price'||field==='qty'||field==='len')?parseFloat(value)||0:value;saveEmployeeData();renderProjectIrons(p);updateProjectSummary(p);}
function addProjectIron(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;if(!p.irons)p.irons=[];p.irons.push({type:'ØªÙŠÙˆØ¨',size:'â€”',thick:'â€”',len:6,price:0,qty:0});saveEmployeeData();renderProjectIrons(p);updateProjectSummary(p);}
function deleteProjectIron(i){if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ'))return;const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.irons.splice(i,1);saveEmployeeData();renderProjectIrons(p);updateProjectSummary(p);}

function renderAdditionalCosts(p){if(!p.additionalCosts)p.additionalCosts={transport:[],dailyWorkers:[],materials:[],other:[]};const rt=(id,arr,cols)=>{const tb=document.getElementById(id);if(arr.length===0){tb.innerHTML=`<tr><td colspan="${cols}" style="text-align:center;color:var(--dim)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>`;return;}};rt('transportTable',p.additionalCosts.transport,4);if(p.additionalCosts.transport.length>0)document.getElementById('transportTable').innerHTML=p.additionalCosts.transport.map((t,i)=>`<tr><td>${t.date}</td><td style="color:var(--amber);font-weight:700">${t.amount.toLocaleString()}</td><td>${t.notes||'-'}</td><td><button class="btn-del" onclick="deleteAdditionalCost('transport',${i})">Ã—</button></td></tr>`).join('');document.getElementById('transportTotal').textContent=p.additionalCosts.transport.reduce((s,t)=>s+t.amount,0).toLocaleString();rt('dailyWorkersTable',p.additionalCosts.dailyWorkers,5);if(p.additionalCosts.dailyWorkers.length>0)document.getElementById('dailyWorkersTable').innerHTML=p.additionalCosts.dailyWorkers.map((w,i)=>`<tr><td>${w.name}</td><td>${w.days}</td><td>${w.wage.toLocaleString()}</td><td style="color:var(--amber);font-weight:700">${w.total.toLocaleString()}</td><td><button class="btn-del" onclick="deleteAdditionalCost('dailyWorkers',${i})">Ã—</button></td></tr>`).join('');document.getElementById('dailyWorkersTotal').textContent=p.additionalCosts.dailyWorkers.reduce((s,w)=>s+w.total,0).toLocaleString();rt('materialsTable',p.additionalCosts.materials,5);if(p.additionalCosts.materials.length>0)document.getElementById('materialsTable').innerHTML=p.additionalCosts.materials.map((m,i)=>`<tr><td>${m.name}</td><td>${m.qty}</td><td>${m.price.toLocaleString()}</td><td style="color:var(--amber);font-weight:700">${m.total.toLocaleString()}</td><td><button class="btn-del" onclick="deleteAdditionalCost('materials',${i})">Ã—</button></td></tr>`).join('');document.getElementById('materialsTotal').textContent=p.additionalCosts.materials.reduce((s,m)=>s+m.total,0).toLocaleString();rt('otherTable',p.additionalCosts.other,4);if(p.additionalCosts.other.length>0)document.getElementById('otherTable').innerHTML=p.additionalCosts.other.map((o,i)=>`<tr><td>${o.description}</td><td style="color:var(--amber);font-weight:700">${o.amount.toLocaleString()}</td><td>${o.notes||'-'}</td><td><button class="btn-del" onclick="deleteAdditionalCost('other',${i})">Ã—</button></td></tr>`).join('');document.getElementById('otherTotal').textContent=p.additionalCosts.other.reduce((s,o)=>s+o.amount,0).toLocaleString();}

function updateProjectSummary(p){const mT=p.materials?p.materials.reduce((s,m)=>s+((m.price||0)*(m.qty||0)),0):0;const iT=p.irons?p.irons.reduce((s,ir)=>s+((ir.price||0)*(ir.qty||0)),0):0;const bC=mT+iT;let aT=0;if(p.additionalCosts){p.additionalCosts.transport?.forEach(t=>aT+=t.amount);p.additionalCosts.dailyWorkers?.forEach(w=>aT+=w.total);p.additionalCosts.materials?.forEach(m=>aT+=m.total);p.additionalCosts.other?.forEach(o=>aT+=o.amount);}const actT=bC+aT,actP=p.salePrice-actT;document.getElementById('finalBaseCost').textContent=bC.toLocaleString();document.getElementById('finalAdditional').textContent=aT.toLocaleString();document.getElementById('finalTotal').textContent=actT.toLocaleString();document.getElementById('finalSale').textContent=p.salePrice.toLocaleString();document.getElementById('finalProfit').textContent=actP.toLocaleString();p.profit=actP;p.totalCost=actT;p.baseCost=bC;saveEmployeeData();}
function toggleProjectStatus(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.status=p.status==='Ù…Ù†ØªÙ‡ÙŠ'?'Ø¬Ø§Ø±ÙŠ':'Ù…Ù†ØªÙ‡ÙŠ';saveEmployeeData();openProjectDetails(currentProjectId);}
function showAddCostMenu(){const t=prompt('Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ:\n1. ØªÙˆØµÙŠÙ„ Ø¹Ù…Ø§Ù„\n2. Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„ÙŠÙˆÙ…ÙŠØ©\n3. Ù…ÙˆØ§Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©\n4. Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰\n\nØ§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù…:');if(t==='1')addTransportCost();else if(t==='2')addDailyWorkerCost();else if(t==='3')addMaterialCost();else if(t==='4')addOtherCost();}
function addTransportCost(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;const a=prompt('Ù…Ø¨Ù„Øº Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø±.Ø³):');if(!a)return;const n=prompt('Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):')||'';if(!p.additionalCosts)p.additionalCosts={transport:[],dailyWorkers:[],materials:[],other:[]};p.additionalCosts.transport.push({date:new Date().toISOString().split('T')[0],amount:parseFloat(a)||0,notes:n});saveEmployeeData();openProjectDetails(currentProjectId);updateEmployeeSummary();}
function addDailyWorkerCost(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;const name=prompt('Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„:');if(!name)return;const days=prompt('Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…:');if(!days)return;const wage=prompt('Ø§Ù„Ø£Ø¬Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø±.Ø³):');if(!wage)return;const d=parseFloat(days)||0,w=parseFloat(wage)||0;if(!p.additionalCosts)p.additionalCosts={transport:[],dailyWorkers:[],materials:[],other:[]};p.additionalCosts.dailyWorkers.push({name,days:d,wage:w,total:d*w});saveEmployeeData();openProjectDetails(currentProjectId);updateEmployeeSummary();}
function addMaterialCost(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;const name=prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:');if(!name)return;const qty=prompt('Ø§Ù„ÙƒÙ…ÙŠØ©:');if(!qty)return;const price=prompt('Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³):');if(!price)return;const q=parseFloat(qty)||0,pr=parseFloat(price)||0;if(!p.additionalCosts)p.additionalCosts={transport:[],dailyWorkers:[],materials:[],other:[]};p.additionalCosts.materials.push({name,qty:q,price:pr,total:q*pr});saveEmployeeData();openProjectDetails(currentProjectId);updateEmployeeSummary();}
function addOtherCost(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;const desc=prompt('ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ:');if(!desc)return;const a=prompt('Ø§Ù„Ù…Ø¨Ù„Øº (Ø±.Ø³):');if(!a)return;const n=prompt('Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):')||'';if(!p.additionalCosts)p.additionalCosts={transport:[],dailyWorkers:[],materials:[],other:[]};p.additionalCosts.other.push({description:desc,amount:parseFloat(a)||0,notes:n});saveEmployeeData();openProjectDetails(currentProjectId);updateEmployeeSummary();}
function deleteAdditionalCost(type,i){if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ'))return;const p=savedProjects.find(x=>x.id===currentProjectId);if(!p||!p.additionalCosts)return;p.additionalCosts[type].splice(i,1);saveEmployeeData();openProjectDetails(currentProjectId);updateEmployeeSummary();}
function uploadBlueprint(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;p.blueprint=e.target.result;saveEmployeeData();openProjectDetails(currentProjectId);};reader.readAsDataURL(file);}
function printProject(){const p=savedProjects.find(x=>x.id===currentProjectId);if(!p)return;const mT=p.materials?p.materials.reduce((s,m)=>s+((m.price||0)*(m.qty||0)),0):0;const iT=p.irons?p.irons.reduce((s,ir)=>s+((ir.price||0)*(ir.qty||0)),0):0;const bC=mT+iT;let aT=0;let report=`\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n           ØªÙ‚Ø±ÙŠØ± Ù…Ø´Ø±ÙˆØ¹: ${p.name}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${p.date}\nğŸ“ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ${p.dimensions.L} Ã— ${p.dimensions.W} Ã— ${p.dimensions.H||0} Ù…ØªØ±\nğŸ”„ Ø§Ù„Ø­Ø§Ù„Ø©: ${p.status}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ§± Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;if(p.materials&&p.materials.length>0)p.materials.forEach((mat,i)=>{const total=(mat.price||0)*(mat.qty||0);report+=`${i+1}. ${mat.name||mat.cat} (${mat.type} - ${mat.thick})\n   Ø§Ù„Ø³Ø¹Ø±: ${(mat.price||0).toLocaleString()} Ø±.Ø³/${mat.unit}\n   Ø§Ù„ÙƒÙ…ÙŠØ©: ${mat.qty} ${mat.unit}\n   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toLocaleString()} Ø±.Ø³\n\n`;});report+=`ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯: ${mT.toLocaleString()} Ø±.Ø³\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ”© Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;if(p.irons&&p.irons.length>0)p.irons.forEach((iron,i)=>{const total=(iron.price||0)*(iron.qty||0);report+=`${i+1}. ${iron.type} (${iron.size} - Ø³Ù…Ùƒ ${iron.thick})\n   Ø§Ù„Ø·ÙˆÙ„: ${iron.len} Ù… | Ø§Ù„Ø³Ø¹Ø±: ${(iron.price||0).toLocaleString()} Ø±.Ø³ | Ø§Ù„ÙƒÙ…ÙŠØ©: ${iron.qty}\n   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toLocaleString()} Ø±.Ø³\n\n`;});report+=`ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ¯: ${iT.toLocaleString()} Ø±.Ø³\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ“ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;if(p.additionalCosts){if(p.additionalCosts.transport?.length>0){report+='\nğŸš— ØªÙˆØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„:\n';p.additionalCosts.transport.forEach(t=>{report+=`   ${t.date}: ${t.amount.toLocaleString()} Ø±.Ø³${t.notes?' - '+t.notes:''}\n`;aT+=t.amount;});}if(p.additionalCosts.dailyWorkers?.length>0){report+='\nğŸ‘· Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:\n';p.additionalCosts.dailyWorkers.forEach(w=>{report+=`   ${w.name}: ${w.days} Ø£ÙŠØ§Ù… Ã— ${w.wage.toLocaleString()} = ${w.total.toLocaleString()} Ø±.Ø³\n`;aT+=w.total;});}if(p.additionalCosts.materials?.length>0){report+='\nğŸ§± Ù…ÙˆØ§Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©:\n';p.additionalCosts.materials.forEach(m=>{report+=`   ${m.name}: ${m.qty} Ã— ${m.price.toLocaleString()} = ${m.total.toLocaleString()} Ø±.Ø³\n`;aT+=m.total;});}if(p.additionalCosts.other?.length>0){report+='\nğŸ“ Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰:\n';p.additionalCosts.other.forEach(o=>{report+=`   ${o.description}: ${o.amount.toLocaleString()} Ø±.Ø³${o.notes?' - '+o.notes:''}\n`;aT+=o.amount;});}}const actT=bC+aT,actP=p.salePrice-actT;report+=`\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ’µ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nØ§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ${bC.toLocaleString()} Ø±.Ø³\nØ§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: ${aT.toLocaleString()} Ø±.Ø³\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nØ§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ${actT.toLocaleString()} Ø±.Ø³\n\nØ³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹: ${p.salePrice.toLocaleString()} Ø±.Ø³\nØ§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙØ¹Ù„ÙŠ: ${actP.toLocaleString()} Ø±.Ø³\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;const blob=new Blob([report],{type:'text/plain;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`ØªÙ‚Ø±ÙŠØ±_${p.name}_${p.date}.txt`;a.click();URL.revokeObjectURL(url);}

// â”€â”€â”€ INIT (async for SQLite) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initApp(){
  try{
    const sqlPromise=initSqlJs({locateFile:file=>'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/'+file});
    const SQL_LIB=await sqlPromise;

    // Try loading from IndexedDB first
    const savedData=await loadDBFromIndexedDB();
    if(savedData){
      DB=new SQL_LIB.Database(savedData);
      // ensure schema exists (for upgrades)
      createSchema();
    }else{
      DB=new SQL_LIB.Database();
      createSchema();
      seedDefaults();
      // Migrate any existing localStorage data
      migrateFromLocalStorage();
      await persistDBToIndexedDB();
    }

    // Load all data from SQLite into JS arrays
    loadFromDB();
    calc();
    showDBStatus('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª SQLite Ø¬Ø§Ù‡Ø²Ø©');
  }catch(e){
    console.error('SQLite init failed:',e);
    // Fallback: use defaults directly
    mdb=JSON.parse(JSON.stringify(DEFAULT_MDB));
    idb=JSON.parse(JSON.stringify(DEFAULT_IDB));
    mats=JSON.parse(JSON.stringify(DEFAULT_MATS));
    irons=JSON.parse(JSON.stringify(DEFAULT_IRONS));
    labs=JSON.parse(JSON.stringify(DEFAULT_LABS));
    employees=DEFAULT_EMPLOYEES.map(e=>({...e,tools:[]}));
    calc();
    alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ SQLite. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© ÙˆÙ„Ù† ØªÙØ­ÙØ¸.');
  }
}

// Make SQL available globally for importDB
let SQL;
initSqlJs({locateFile:file=>'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/'+file}).then(s=>{SQL=s;});

initApp();

function checkPassword(){const input=document.getElementById('passwordInput').value;if(input==='Turki305'){document.getElementById('passwordOverlay').style.display='none';document.getElementById('passwordInput').value='';renderEmployees();renderCarRecords();renderProjects();}else{const e=document.getElementById('errorMsg');e.style.display='block';document.getElementById('passwordInput').value='';document.getElementById('passwordInput').focus();setTimeout(()=>e.style.display='none',3000);}}
window.addEventListener('load',()=>document.getElementById('passwordInput').focus());
</script>
</body>
</html>
